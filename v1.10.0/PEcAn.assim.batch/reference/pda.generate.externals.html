<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>This is a helper function for preparing PDA external objects, but it doesn't cover all the cases yet, use it with care You can use this function just to generate either one of the external.* PDA objects, but note that some args cannot be blank depending on what you aim to generate — pda.generate.externals • PEcAn.assim.batch</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="This is a helper function for preparing PDA external objects, but it doesn't cover all the cases yet, use it with care You can use this function just to generate either one of the external.* PDA objects, but note that some args cannot be blank depending on what you aim to generate — pda.generate.externals"><meta name="description" content="This is a helper function for preparing PDA external objects, but it doesn't cover all the cases yet, use it with care
You can use this function just to generate either one of the external.* PDA objects, but note that some args cannot be blank depending on what you aim to generate"><meta property="og:description" content="This is a helper function for preparing PDA external objects, but it doesn't cover all the cases yet, use it with care
You can use this function just to generate either one of the external.* PDA objects, but note that some args cannot be blank depending on what you aim to generate"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PEcAn.assim.batch</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.9.1</small>

    <a href="../index.html" style="padding: 0em 1em">← Up</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/AssimBatchVignette.html">PEcAn.assim.batch Vignette</a></li>
    <li><a class="dropdown-item" href="../articles/MultiSitePDAVignette.html">Multi-site hierarchical calibration vignette</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>This is a helper function for preparing PDA external objects, but it doesn't cover all the cases yet, use it with care You can use this function just to generate either one of the external.* PDA objects, but note that some args cannot be blank depending on what you aim to generate</h1>
      <small class="dont-index">Source: <a href="https://github.com/PecanProject/pecan/blob/v1.10.0/modules/assim.batch/R/pda.generate.externals.R" class="external-link"><code>R/pda.generate.externals.R</code></a></small>
      <div class="d-none name"><code>pda.generate.externals.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This is a helper function for preparing PDA external objects, but it doesn't cover all the cases yet, use it with care
You can use this function just to generate either one of the external.* PDA objects, but note that some args cannot be blank depending on what you aim to generate</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pda.generate.externals</span><span class="op">(</span></span>
<span>  external.data <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  obs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  varn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  varid <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_eff <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  align_method <span class="op">=</span> <span class="st">"match_timestep"</span>,</span>
<span>  par <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  model_data_diag <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  model.out <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  start_date <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  end_date <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  external.formats <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  external.priors <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  prior.list <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  external.knots <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  knots.list <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ind.list <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nknots <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-external-data">external.data<a class="anchor" aria-label="anchor" href="#arg-external-data"></a></dt>
<dd><p>boolean, if TRUE function will generate external.data for PDA, then you need to pass varn and obs too, as well as align_method if different than "match_timestep"</p></dd>


<dt id="arg-obs">obs<a class="anchor" aria-label="anchor" href="#arg-obs"></a></dt>
<dd><p>your data as a(n ordered) list where each sublist corresponds to a data frame of your constraining variable with two columns, variable name - posix
IMPORTANT: your obs must be in the same units as PEcAn standards already, this function doesn't do unit conversions!
IMPORTANT: your obs must be ready to compare with model outputs in general, e.g. if you're passing flux data it should already be ustar filtered
e.g.
obs[[1]]
NEE           posix
4.590273e-09  2017-01-01 00:00:00
NA  2017-01-01 00:30:00
NA  2017-01-01 01:00:00
NA  2017-01-01 01:30:00
NA  2017-01-01 02:00:00
4.575248e-09  2017-01-01 02:30:00
if you have more than variable make sure the order you pass the data is the same as varn. E.g. for varn=c("NEE", "Qle"), external.data should be
obs[[1]]
NEE  posix
NA   2018-05-09
NA   2018-05-10
NA   2018-05-11
NA   2018-05-12
... ... ...
obs[[2]]
Qle  posix
NA   2018-05-09
NA   2018-05-10
NA   2018-05-11
NA   2018-05-12
... ... ...</p></dd>


<dt id="arg-varn">varn<a class="anchor" aria-label="anchor" href="#arg-varn"></a></dt>
<dd><p>a vector of PEcAn standard variable name(s) to read from model outputs, e.g. c("NEE", "Qle")</p></dd>


<dt id="arg-varid">varid<a class="anchor" aria-label="anchor" href="#arg-varid"></a></dt>
<dd><p>a vector of BETY variable id(s) of your constraints, e.g. for varn = c("NEE", "Qle"), varid = c(297, 298)</p></dd>


<dt id="arg-n-eff">n_eff<a class="anchor" aria-label="anchor" href="#arg-n-eff"></a></dt>
<dd><p>effective sample size of constraints, PDA functions estimates it for NEE and LE, and uses it in the heteroskedastic Laplacian only, if you already know it passing it now will save you some time</p></dd>


<dt id="arg-align-method">align_method<a class="anchor" aria-label="anchor" href="#arg-align-method"></a></dt>
<dd><p>one of the benchmark::align_data align_method options "match_timestep" or "mean_over_larger_timestep", defaults to "match_timestep"</p></dd>


<dt id="arg-par">par<a class="anchor" aria-label="anchor" href="#arg-par"></a></dt>
<dd><p>list with vector sublists of likelihood parameters of heteroskedastic laplacian for flux data, function calculates it if NULL for NEE, FC, and Qle. Leave empty for other variables
e.g. AMF.params &lt;- PEcAn.uncertainty::flux.uncertainty(...fill in...)
par &lt;- list(c(AMF.params$intercept, AMF.params$slopeP, AMF.params$slopeN))</p></dd>


<dt id="arg-model-data-diag">model_data_diag<a class="anchor" aria-label="anchor" href="#arg-model-data-diag"></a></dt>
<dd><p>optional for diagnostics, if you want to check whether your model and data will be aligned in PDA properly you can return a dataframe
as well as plot a quick &amp; dirty timerseries graph</p></dd>


<dt id="arg-model-out">model.out<a class="anchor" aria-label="anchor" href="#arg-model-out"></a></dt>
<dd><p>an example model output folder to align your data with model, e.g. "/data/workflows/PEcAn_15000000111/out/15000186876"</p></dd>


<dt id="arg-start-date">start_date<a class="anchor" aria-label="anchor" href="#arg-start-date"></a></dt>
<dd><p>the start date of the model.out run, e.g. "2017-01-01"</p></dd>


<dt id="arg-end-date">end_date<a class="anchor" aria-label="anchor" href="#arg-end-date"></a></dt>
<dd><p>the end date of the model.out run, e.g. "2018-12-31"</p></dd>


<dt id="arg-external-formats">external.formats<a class="anchor" aria-label="anchor" href="#arg-external-formats"></a></dt>
<dd><p>boolean, if TRUE make sure to pass the varn argument</p></dd>


<dt id="arg-external-priors">external.priors<a class="anchor" aria-label="anchor" href="#arg-external-priors"></a></dt>
<dd><p>boolean, if TRUE pass prior.list argument too</p></dd>


<dt id="arg-prior-list">prior.list<a class="anchor" aria-label="anchor" href="#arg-prior-list"></a></dt>
<dd><p>a list of prior dataframes (one per pft, make sure the order is the same as it is in your &lt;assim.batch&gt; block), if you're using this make sure the targeted parameters are on the list
e.g.
prior.list &lt;-  list(data.frame(distn = c("norm", "beta"), parama = c(4, 1),  paramb = c(7,2),   n = rep(NA, 2), row.names = c("growth_resp_factor", "leaf_turnover_rate")),
data.frame(distn = c("unif", "unif"), parama = c(10, 4), paramb = c(40,27), n = rep(NA, 2), row.names = c("psnTOpt", "half_saturation_PAR")))</p></dd>


<dt id="arg-external-knots">external.knots<a class="anchor" aria-label="anchor" href="#arg-external-knots"></a></dt>
<dd><p>boolean, if TRUE pass prior.list, ind.list, nknots OR knots.list arguments too</p></dd>


<dt id="arg-knots-list">knots.list<a class="anchor" aria-label="anchor" href="#arg-knots-list"></a></dt>
<dd><p>a list of dataframes (one per pft) where each row is a parameter vector, i.e. training points for the emulator.
If not NULL these are used, otherwise knots will be generated using prior.list, ind.list and nknots.</p></dd>


<dt id="arg-ind-list">ind.list<a class="anchor" aria-label="anchor" href="#arg-ind-list"></a></dt>
<dd><p>a named list of vectors (one per pft), where each vector indicates the indices of the parameters on the prior.list targeted in the PDA
e.g. ind.list &lt;-  list(temperate.deciduous = c(2), temperate.conifer = c(1,2))</p></dd>


<dt id="arg-nknots">nknots<a class="anchor" aria-label="anchor" href="#arg-nknots"></a></dt>
<dd><p>number of knots you want to train the emulator on</p></dd>

</dl></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">pda.externals</span> <span class="op">&lt;-</span>  <span class="fu">pda.generate.externals</span><span class="op">(</span>external.data   <span class="op">=</span> <span class="cn">TRUE</span>, obs <span class="op">=</span> <span class="va">obs</span>, </span></span>
<span class="r-in"><span>varn <span class="op">=</span> <span class="st">"NEE"</span>, varid <span class="op">=</span> <span class="fl">297</span>, n_eff <span class="op">=</span> <span class="fl">106.9386</span>,</span></span>
<span class="r-in"><span>external.formats <span class="op">=</span> <span class="cn">TRUE</span>, model_data_diag <span class="op">=</span> <span class="cn">TRUE</span>, </span></span>
<span class="r-in"><span>model.out <span class="op">=</span> <span class="st">"/tmp/out/outdir"</span>,</span></span>
<span class="r-in"><span>start_date <span class="op">=</span> <span class="st">"2017-01-01"</span>, end_date <span class="op">=</span> <span class="st">"2018-12-31"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mike Dietze, Istem Fer, Ryan Kelly.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

