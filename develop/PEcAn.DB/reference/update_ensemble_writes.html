<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Insert or Update Database Records for New or Modified Input Data — update_ensemble_writes • PEcAn.DB</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Insert or Update Database Records for New or Modified Input Data — update_ensemble_writes"><meta name="description" content='This function is called internally by [convert_input()] to insert or update **input** and **dbfile** records in the PEcAn BETY database after one or more data-conversion or download functions have produced local or remote files. It is specifically intended for use with the output from data-conversion functions called by [convert_input()] (e.g. various "download_X" or "met2model_X" functions), but can be adapted if the return structure matches the requirements below.'><meta property="og:description" content='This function is called internally by [convert_input()] to insert or update **input** and **dbfile** records in the PEcAn BETY database after one or more data-conversion or download functions have produced local or remote files. It is specifically intended for use with the output from data-conversion functions called by [convert_input()] (e.g. various "download_X" or "met2model_X" functions), but can be adapted if the return structure matches the requirements below.'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PEcAn.DB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.8.1</small>

    <a href="../index.html" style="padding: 0em 1em">← Up</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/betydb_access.html">BETYdb Access</a></li>
    <li><a class="dropdown-item" href="../articles/create_sites.geometry.html">Create PostGIS polygon</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Insert or Update Database Records for New or Modified Input Data</h1>
      <small class="dont-index">Source: <a href="https://github.com/PecanProject/pecan/blob/develop/base/db/R/update_ensemble_writes.R" class="external-link"><code>R/update_ensemble_writes.R</code></a></small>
      <div class="d-none name"><code>update_ensemble_writes.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function is called internally by [convert_input()] to insert or update **input** and **dbfile** records in the PEcAn BETY database after one or more data-conversion or download functions have produced local or remote files. It is specifically intended for use with the output from data-conversion functions called by [convert_input()] (e.g. various "download_X" or "met2model_X" functions), but can be adapted if the return structure matches the requirements below.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">update_ensemble_writes</span><span class="op">(</span></span>
<span>  <span class="va">result</span>,</span>
<span>  <span class="va">con</span>,</span>
<span>  <span class="va">start_date</span>,</span>
<span>  <span class="va">end_date</span>,</span>
<span>  <span class="va">overwrite</span>,</span>
<span>  <span class="va">insert.new.file</span>,</span>
<span>  <span class="va">input.args</span>,</span>
<span>  <span class="va">machine</span>,</span>
<span>  <span class="va">mimetype</span>,</span>
<span>  <span class="va">formatname</span>,</span>
<span>  <span class="va">allow.conflicting.dates</span>,</span>
<span>  <span class="va">ensemble</span>,</span>
<span>  <span class="va">ensemble_name</span>,</span>
<span>  <span class="va">existing.input</span>,</span>
<span>  <span class="va">existing.dbfile</span>,</span>
<span>  <span class="va">input</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-result">result<a class="anchor" aria-label="anchor" href="#arg-result"></a></dt>
<dd><p>list of data frames, each data frame corresponding to one piece or "chunk" of newly-created data. Typically, these data frames are produced by the function specified in `convert_input(..., fcn=...)`. Each data frame must contain at least:</p><dl><dt>file</dt>
<dd><p>Absolute file path(s) to the newly created file(s).</p></dd>
 <dt>dbfile.name</dt>
<dd><p>The base filename(s) (without leading path) for each corresponding file.</p></dd>

</dl><p>Additional columns are allowed but unused by this function.</p></dd>


<dt id="arg-con">con<a class="anchor" aria-label="anchor" href="#arg-con"></a></dt>
<dd><p>database connection object (as returned by, e.g., <code><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></code>).</p></dd>


<dt id="arg-start-date">start_date<a class="anchor" aria-label="anchor" href="#arg-start-date"></a></dt>
<dd><p>Date or character. The start date of the data (in UTC). Acceptable types include Date objects (`as.Date`) or character strings that can be parsed to a Date via standard R conversions.</p></dd>


<dt id="arg-end-date">end_date<a class="anchor" aria-label="anchor" href="#arg-end-date"></a></dt>
<dd><p>Date or character. The end date of the data (in UTC). Acceptable types include Date objects (`as.Date`) or character strings that can be parsed to a Date via standard R conversions.</p></dd>


<dt id="arg-overwrite">overwrite<a class="anchor" aria-label="anchor" href="#arg-overwrite"></a></dt>
<dd><p>logical. If `TRUE`, any existing database records and files for the same input and date range should be overwritten with the new files. If `FALSE`, existing files are preserved.</p></dd>


<dt id="arg-insert-new-file">insert.new.file<a class="anchor" aria-label="anchor" href="#arg-insert-new-file"></a></dt>
<dd><p>logical. If `TRUE`, forces the creation of a new **dbfile** entry even if an existing entry is found. Typically used for forecast or ensemble data that may be partially present.</p></dd>


<dt id="arg-input-args">input.args<a class="anchor" aria-label="anchor" href="#arg-input-args"></a></dt>
<dd><p>list. This is passed from [convert_input()] and contains auxiliary arguments or settings that were passed along internally. It may include items such as `newsite` (integer site ID), among others. Its exact contents are not strictly defined but typically include the arguments provided to `convert_input()`.</p></dd>


<dt id="arg-machine">machine<a class="anchor" aria-label="anchor" href="#arg-machine"></a></dt>
<dd><p>data.frame. Single row describing the machine on which the new data resides. It typically has columns like `id` and `hostname`, indicating the corresponding row in BETY's `machines` table.</p></dd>


<dt id="arg-mimetype">mimetype<a class="anchor" aria-label="anchor" href="#arg-mimetype"></a></dt>
<dd><p>character. String indicating the file's MIME type (e.g. `"text/csv"`, `"application/x-netcdf"`, etc.).</p></dd>


<dt id="arg-formatname">formatname<a class="anchor" aria-label="anchor" href="#arg-formatname"></a></dt>
<dd><p>character. String describing the file format (as listed in BETYdb's `formats` table). For example `"CF Meteorology"`.</p></dd>


<dt id="arg-allow-conflicting-dates">allow.conflicting.dates<a class="anchor" aria-label="anchor" href="#arg-allow-conflicting-dates"></a></dt>
<dd><p>logical. If `TRUE`, allows creation or insertion of new file records even if their date range overlaps with existing records. If `FALSE`, overlapping ranges may cause errors or be disallowed.</p></dd>


<dt id="arg-ensemble">ensemble<a class="anchor" aria-label="anchor" href="#arg-ensemble"></a></dt>
<dd><p>integer or logical. If an integer &gt; 1, indicates that multiple ensemble members were generated (often for forecast data) and that each member may need separate database entries. If `FALSE`, the data are not an ensemble.</p></dd>


<dt id="arg-ensemble-name">ensemble_name<a class="anchor" aria-label="anchor" href="#arg-ensemble-name"></a></dt>
<dd><p>character. String providing a descriptive label or identifier for an ensemble member. Typically used if `convert_input()` is called iteratively for each member.</p></dd>


<dt id="arg-existing-input">existing.input<a class="anchor" aria-label="anchor" href="#arg-existing-input"></a></dt>
<dd><p>data.frame. Possibly zero rows representing the current record(s) in the `inputs` table that match (or partially match) the data being added. If no matching record exists, an empty data frame is supplied.</p></dd>


<dt id="arg-existing-dbfile">existing.dbfile<a class="anchor" aria-label="anchor" href="#arg-existing-dbfile"></a></dt>
<dd><p>data.frame. Possibly zero rows representing the current record(s) in the `dbfiles` table that match (or partially match) the data being added. If no matching record exists, an empty data frame is supplied.</p></dd>


<dt id="arg-input">input<a class="anchor" aria-label="anchor" href="#arg-input"></a></dt>
<dd><p>data.frame. Single row with the parent input record from BETYdb, typically including columns like `id`, `start_date`, `end_date`, etc. If the new data are derived from an existing input, this links them in the `parent_id` column of the new entries.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>list with two elements:</p><dl><dt>input.id</dt>
<dd><p>A numeric vector of new (or updated) input record IDs.</p></dd>
 <dt>dbfile.id</dt>
<dd><p>A numeric vector of new (or updated) dbfile record IDs.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Insert or Update Database Records for New or Modified Input Data</p>
<p>This function consolidates the final step of adding or updating records in the BETY database to reflect newly created data files. It either updates existing `input` and `dbfile` records or creates new records, depending on the provided arguments (`overwrite`, `insert.new.file`, etc.) and whether a matching record already exists. Typically, these records represent model-ready meteorological or other environmental data, after format conversion or downloading has taken place in [convert_input()].</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Betsy Cowdery, Michael Dietze, Ankur Desai, Tony Gardella, Luke Dramko</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by David LeBauer, Mike Dietze, Rob Kooper, Shawn Serbin, Elizabeth Cowdery, Ankur Desai, Istem Fer, Alexey Shiklomanov, Tony Gardella, Chris Black, Liam Burke, Ryan Kelly, Dan Wang, Carl Davidson, Xiaohui Feng, Shashank Singh.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

