<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Convert between formats, reusing existing files where possible — convert_input • PEcAn.DB</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Convert between formats, reusing existing files where possible — convert_input"><meta name="description" content="convert_input is a relatively generic function that applies the function fcn and inserts a record of it into the database. It is primarily designed for converting meteorological data between formats and can be used on observed data, forecasts, and ensembles of forecasts.
To minimize downloading and storing duplicate data, it first checks to see if a given file is already in the
database before applying fcn."><meta property="og:description" content="convert_input is a relatively generic function that applies the function fcn and inserts a record of it into the database. It is primarily designed for converting meteorological data between formats and can be used on observed data, forecasts, and ensembles of forecasts.
To minimize downloading and storing duplicate data, it first checks to see if a given file is already in the
database before applying fcn."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PEcAn.DB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.8.1.9000</small>

    <a href="../index.html" style="padding: 0em 1em">← Up</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/betydb_access.html">BETYdb Access</a></li>
    <li><a class="dropdown-item" href="../articles/create_sites.geometry.html">Create PostGIS polygon</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Convert between formats, reusing existing files where possible</h1>
      <small class="dont-index">Source: <a href="https://github.com/PecanProject/pecan/blob/develop/base/db/R/convert_input.R" class="external-link"><code>R/convert_input.R</code></a></small>
      <div class="d-none name"><code>convert_input.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>convert_input</code> is a relatively generic function that applies the function <code>fcn</code> and inserts a record of it into the database. It is primarily designed for converting meteorological data between formats and can be used on observed data, forecasts, and ensembles of forecasts.
To minimize downloading and storing duplicate data, it first checks to see if a given file is already in the
database before applying <code>fcn</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">convert_input</span><span class="op">(</span></span>
<span>  <span class="va">input.id</span>,</span>
<span>  <span class="va">outfolder</span>,</span>
<span>  <span class="va">formatname</span>,</span>
<span>  <span class="va">mimetype</span>,</span>
<span>  <span class="va">site.id</span>,</span>
<span>  <span class="va">start_date</span>,</span>
<span>  <span class="va">end_date</span>,</span>
<span>  <span class="va">pkg</span>,</span>
<span>  <span class="va">fcn</span>,</span>
<span>  con <span class="op">=</span> <span class="va">con</span>,</span>
<span>  <span class="va">host</span>,</span>
<span>  write <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">format.vars</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  exact.dates <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  allow.conflicting.dates <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  insert.new.file <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  pattern <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  forecast <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  ensemble <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  ensemble_name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dbparms <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-input-id">input.id<a class="anchor" aria-label="anchor" href="#arg-input-id"></a></dt>
<dd><p>The database id of the input file of the parent of the file being processed here.  The parent will have the same data, but in a different format.</p></dd>


<dt id="arg-outfolder">outfolder<a class="anchor" aria-label="anchor" href="#arg-outfolder"></a></dt>
<dd><p>The directory where files generated by functions called by convert_input will be placed</p></dd>


<dt id="arg-formatname">formatname<a class="anchor" aria-label="anchor" href="#arg-formatname"></a></dt>
<dd><p>data product specific format name</p></dd>


<dt id="arg-mimetype">mimetype<a class="anchor" aria-label="anchor" href="#arg-mimetype"></a></dt>
<dd><p>data product specific file format</p></dd>


<dt id="arg-site-id">site.id<a class="anchor" aria-label="anchor" href="#arg-site-id"></a></dt>
<dd><p>The id of the site</p></dd>


<dt id="arg-start-date">start_date<a class="anchor" aria-label="anchor" href="#arg-start-date"></a></dt>
<dd><p>Start date of the data being requested or processed</p></dd>


<dt id="arg-end-date">end_date<a class="anchor" aria-label="anchor" href="#arg-end-date"></a></dt>
<dd><p>End date of the data being requested or processed</p></dd>


<dt id="arg-pkg">pkg<a class="anchor" aria-label="anchor" href="#arg-pkg"></a></dt>
<dd><p>The package that the function being executed is in (as a string)</p></dd>


<dt id="arg-fcn">fcn<a class="anchor" aria-label="anchor" href="#arg-fcn"></a></dt>
<dd><p>The function to be executed if records of the output file aren't found in the database. (as a string)</p></dd>


<dt id="arg-con">con<a class="anchor" aria-label="anchor" href="#arg-con"></a></dt>
<dd><p>Database connection object</p></dd>


<dt id="arg-host">host<a class="anchor" aria-label="anchor" href="#arg-host"></a></dt>
<dd><p>Named list identifying the machine where conversion should be performed.
Currently only <code>host$name</code> and <code>host$Rbinary</code> are used by <code>convert_input</code>,
 but the whole list is passed to other functions</p></dd>


<dt id="arg-write">write<a class="anchor" aria-label="anchor" href="#arg-write"></a></dt>
<dd><p>Logical: Write new file records to the database?</p></dd>


<dt id="arg-format-vars">format.vars<a class="anchor" aria-label="anchor" href="#arg-format-vars"></a></dt>
<dd><p>Passed on as arguments to <code>fcn</code></p></dd>


<dt id="arg-overwrite">overwrite<a class="anchor" aria-label="anchor" href="#arg-overwrite"></a></dt>
<dd><p>Logical: If a file already exists, create a fresh copy? Passed along to fcn.</p></dd>


<dt id="arg-exact-dates">exact.dates<a class="anchor" aria-label="anchor" href="#arg-exact-dates"></a></dt>
<dd><p>Ignore time-span appending and enforce exact start and end dates on the database input file? (logical)</p></dd>


<dt id="arg-allow-conflicting-dates">allow.conflicting.dates<a class="anchor" aria-label="anchor" href="#arg-allow-conflicting-dates"></a></dt>
<dd><p>Should overlapping years ignore time-span appending and exist as separate input files? (logical)</p></dd>


<dt id="arg-insert-new-file">insert.new.file<a class="anchor" aria-label="anchor" href="#arg-insert-new-file"></a></dt>
<dd><p>Logical: force creation of a new database record even if one already exists?</p></dd>


<dt id="arg-pattern">pattern<a class="anchor" aria-label="anchor" href="#arg-pattern"></a></dt>
<dd><p>A regular expression, passed to <code>dbfile.input.check</code>, used to match the name of the input file.</p></dd>


<dt id="arg-forecast">forecast<a class="anchor" aria-label="anchor" href="#arg-forecast"></a></dt>
<dd><p>Logical: Is the data product a forecast?</p></dd>


<dt id="arg-ensemble">ensemble<a class="anchor" aria-label="anchor" href="#arg-ensemble"></a></dt>
<dd><p>An integer representing the number of ensembles, or FALSE if it data product is not an ensemble.</p></dd>


<dt id="arg-ensemble-name">ensemble_name<a class="anchor" aria-label="anchor" href="#arg-ensemble-name"></a></dt>
<dd><p>If convert_input is being called iteratively for each ensemble, ensemble_name contains the identifying name/number for that ensemble.</p></dd>


<dt id="arg-dbparms">dbparms<a class="anchor" aria-label="anchor" href="#arg-dbparms"></a></dt>
<dd><p>list of parameters to use for opening a database connection</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments, passed unchanged to <code>fcn</code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list of two BETY IDs (input.id, dbfile.id) identifying a pre-existing file if one was available, or a newly created file if not.  Each id may be a vector of ids if the function is processing an entire ensemble at once.</p>
    </div>
    <div class="section level2">
    <h2 id="executing-the-function">Executing the function<a class="anchor" aria-label="anchor" href="#executing-the-function"></a></h2>


<p>convert_input executes the function fcn in package pkg via PEcAn.remote::remote.execute.R.  All additional arguments passed to
convert_input (...) are in turn passed along to fcn as arguments.  In addition, several named arguments to convert_input are passed
along to fcn.  The command to execute fcn is built as a string.</p>
    </div>
    <div class="section level2">
    <h2 id="database-files">Database files<a class="anchor" aria-label="anchor" href="#database-files"></a></h2>


<p>There are two kinds of database records (in different tables) that represent a given data file in the file system.  An input file
contains information about the contents of the data file.  A dbfile contains machine spacific information for a given input file,
such as the file path.  Because duplicates of data files for a given input can be on multiple different machines, there can be more
than one dbfile for a given input file.</p>
    </div>
    <div class="section level2">
    <h2 id="time-span-appending">Time-span appending<a class="anchor" aria-label="anchor" href="#time-span-appending"></a></h2>


<p>By default, convert_input tries to optimize the download of most data products by only downloading the years of data not present on
the current machine.  (For example, if files for 2004-2008 exist for a given data product exist on this machine and the user requests
2006-2010, the function will only download data for 2009 and 2010).  In year-long data files, each year exists as a separate file.
The database input file contains records of the bounds of the range stored by those years.  The data optimization can be turned off
by overriding the default values for exact.dates and allow.conflicting.dates.</p>
    </div>
    <div class="section level2">
    <h2 id="forecast-data">Forecast data<a class="anchor" aria-label="anchor" href="#forecast-data"></a></h2>


<p>If the flag forecast is TRUE, convert_input treats data as if it were forecast data.  Forecast data do not undergo time span
appending.</p>
    </div>
    <div class="section level2">
    <h2 id="ensembles">Ensembles<a class="anchor" aria-label="anchor" href="#ensembles"></a></h2>


<p>convert_input has the capability to handle ensembles of met data.  If ensemble = an integer &gt; 1, convert_input checks the database
for records of all ensemble members, and calls fcn if at least one is missing.  convert_input assumes that fcn will return records
for all ensembles. convert_input can also be called iteratevely for each ensemble member.  In this case ensemble_name contains the
unique identifying name/number of the ensemble to be processed.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Betsy Cowdery, Michael Dietze, Ankur Desai, Tony Gardella, Luke Dramko</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by David LeBauer, Mike Dietze, Rob Kooper, Shawn Serbin, Elizabeth Cowdery, Ankur Desai, Istem Fer, Alexey Shiklomanov, Tony Gardella, Chris Black, Liam Burke, Ryan Kelly, Dan Wang, Carl Davidson, Xiaohui Feng, Shashank Singh.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

