<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>BETYdb Access • PEcAn.DB</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="BETYdb Access">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PEcAn.DB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.8.1.9000</small>

    <a href="../index.html" style="padding: 0em 1em">← Up</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/betydb_access.html">BETYdb Access</a></li>
    <li><a class="dropdown-item" href="../articles/create_sites.geometry.html">Create PostGIS polygon</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>BETYdb Access</h1>
                        <h4 data-toc-skip class="author">David
LeBauer</h4>
            
            <h4 data-toc-skip class="date">7/30/2015</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/PecanProject/pecan/blob/develop/base/db/vignettes/betydb_access.Rmd" class="external-link"><code>vignettes/betydb_access.Rmd</code></a></small>
      <div class="d-none name"><code>betydb_access.Rmd</code></div>
    </div>

    
    
<p>Ways to Access BETYdb from R</p>
<div class="section level3">
<h3 id="pecan-db-functions">PEcAn.DB functions<a class="anchor" aria-label="anchor" href="#pecan-db-functions"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">settings</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>database <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bety <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>driver <span class="op">=</span> <span class="st">"PostgreSQL"</span>, user <span class="op">=</span> <span class="st">"bety"</span>, dbname <span class="op">=</span> <span class="st">"bety"</span>, password <span class="op">=</span> <span class="st">"bety"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># equivalent to standard method to load PEcAn settings:</span></span>
<span><span class="co"># settings &lt;- read.settings("pecan.xml")</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pecanproject.github.io" class="external-link">PEcAn.DB</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tomoakin/RPostgreSQL" class="external-link">RPostgreSQL</a></span><span class="op">)</span></span>
<span><span class="va">dbcon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db.open.html">db.open</a></span><span class="op">(</span><span class="va">settings</span><span class="op">$</span><span class="va">database</span><span class="op">$</span><span class="va">bety</span><span class="op">)</span></span>
<span></span>
<span><span class="va">miscanthus</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/db.query.html">db.query</a></span><span class="op">(</span><span class="st">"select lat, lon, date, trait, units, mean from traits_and_yields_view where genus = 'Miscanthus';"</span>, con <span class="op">=</span> <span class="va">dbcon</span><span class="op">)</span></span>
<span></span>
<span><span class="va">salix_spp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query.pft_species.html">query.pft_species</a></span><span class="op">(</span>pft <span class="op">=</span> <span class="st">"salix"</span>, modeltype <span class="op">=</span> <span class="st">"BIOCRO"</span>, con <span class="op">=</span> <span class="va">dbcon</span><span class="op">)</span></span>
<span></span>
<span><span class="va">salix_vcmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/query.trait.data.html">query.trait.data</a></span><span class="op">(</span>trait <span class="op">=</span> <span class="st">"Vcmax"</span>, spstr <span class="op">=</span> <span class="fu">vecpaste</span><span class="op">(</span><span class="va">salix_spp</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>, con <span class="op">=</span> <span class="va">dbcon</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="r-dplyr-interface">R dplyr interface<a class="anchor" aria-label="anchor" href="#r-dplyr-interface"></a>
</h3>
<p>Documentation for the <code>dplyr</code> interface to databases is
provided in the <a href="https://CRAN.R-project.org/package=dplyr" class="external-link">dplyr
vignette</a></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">settings</span><span class="op">$</span><span class="va">database</span><span class="op">$</span><span class="va">bety</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dbname"</span>, <span class="st">"password"</span>, <span class="st">"host"</span>, <span class="st">"user"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">bety</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span></span>
<span>    drv <span class="op">=</span> <span class="fu">RPostgres</span><span class="fu">::</span><span class="fu"><a href="https://rpostgres.r-dbi.org/reference/Postgres.html" class="external-link">Postgres</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    host <span class="op">=</span> <span class="va">d</span><span class="op">$</span><span class="va">host</span>,</span>
<span>    user <span class="op">=</span> <span class="va">d</span><span class="op">$</span><span class="va">user</span>,</span>
<span>    password <span class="op">=</span> <span class="va">d</span><span class="op">$</span><span class="va">password</span>,</span>
<span>    dbname <span class="op">=</span> <span class="va">d</span><span class="op">$</span><span class="va">dbname</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># (Note: you could also do this as `bety &lt;- db.open(settings$database$bety)`,</span></span>
<span><span class="co"># but we show the dbConnect version to emphasize that you can, if you wish,</span></span>
<span><span class="co"># access BETY without using PEcAn)</span></span>
<span></span>
<span></span>
<span><span class="va">species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">bety</span>, <span class="st">'species'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">scientificname</span>, <span class="va">genus</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">genus</span> <span class="op">==</span> <span class="st">"Miscanthus"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>specie_id <span class="op">=</span> <span class="va">id</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">yields</span> <span class="op">&lt;-</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">bety</span>, <span class="st">'yields'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">mean</span>, <span class="va">site_id</span>, <span class="va">specie_id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span><span class="va">bety</span>, <span class="st">'sites'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">sitename</span>, <span class="va">city</span>, <span class="va">country</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>site_id <span class="op">=</span> <span class="va">id</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">mxgdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">yields</span>, by <span class="op">=</span> <span class="st">'specie_id'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">sites</span>, by <span class="op">=</span> <span class="st">'site_id'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">".x"</span><span class="op">)</span>, <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">ends_with</a></span><span class="op">(</span><span class="st">".y"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># drops duplicate rows</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="ropensci-traits-api">rOpensci traits API<a class="anchor" aria-label="anchor" href="#ropensci-traits-api"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install_github("ropensci/traits")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/traits/" class="external-link">"traits"</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/traits/reference/betydb_query.html" class="external-link">betydb_search</a></span><span class="op">(</span>query <span class="op">=</span> <span class="st">"Switchgrass Yield"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span><span class="op">)</span></span>
<span><span class="va">out</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean_result <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">mean</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html" class="external-link">desc</a></span><span class="op">(</span><span class="va">mean_result</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David LeBauer, Mike Dietze, Rob Kooper, Shawn Serbin, Elizabeth Cowdery, Ankur Desai, Istem Fer, Alexey Shiklomanov, Tony Gardella, Chris Black, Liam Burke, Ryan Kelly, Dan Wang, Carl Davidson, Xiaohui Feng, Shashank Singh.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
