<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>PEcAn Package for Integration of the ModelName Model • PEcAn.ModelName</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="PEcAn Package for Integration of the ModelName Model">
<meta name="description" content="This module provides functions to link the (ModelName) to PEcAn.">
<meta property="og:description" content="This module provides functions to link the (ModelName) to PEcAn.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">PEcAn.ModelName</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.8.1.9000</small>

    <a href="../index.html" style="padding: 0em 1em">← Up</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="a-generic-template-for-adding-a-new-model-to-pecan">A generic template for adding a new model to PEcAn<a class="anchor" aria-label="anchor" href="#a-generic-template-for-adding-a-new-model-to-pecan"></a>
</h1></div>
<p>Adding a new model to PEcAn in a few easy steps:</p>
<ol style="list-style-type: decimal">
<li>add modeltype to BETY</li>
<li>add a model and PFT to BETY for use with modeltype</li>
<li>implement 3 functions as described below</li>
<li>Add tests to <code>tests/testthat</code>
</li>
<li>Update README, documentation</li>
<li>Update Dockerfile and model_info.json</li>
<li>execute pecan with new model</li>
</ol>
<div class="section level3">
<h3 id="three-functions">Three Functions<a class="anchor" aria-label="anchor" href="#three-functions"></a>
</h3>
<p>There are 3 functions that will need to be implemented, each of these functions will need to have MODEL be replaced with the actual modeltype as it is defined in the BETY database.</p>
<ul>
<li><code>write.config.MODEL.R</code></li>
</ul>
<p>This will write the configuratin file as well as the job launcher used by PEcAn. There is an example of the job execution script in the template folder. The configuration file can also be a template that is found based on the revision number of the model. This should use the computed results specified in defaults and trait.values to write a configuration file based on the PFT and traits found.</p>
<ul>
<li><code>met2model.MODEL.R</code></li>
</ul>
<p>This will convert the standard Met CF file to the model specific file format. This will allow PEcAn to create metereological files for the specific site and model. This will only be called if no meterological data is found for that specific site and model combination.</p>
<ul>
<li><code>model2netcdf.MODEL.R</code></li>
</ul>
<p>This will convert the model specific output to NACP Intercomparison format. After this function is finished PEcAn will use the generated output and not use the model specific outputs. The outputs should be named YYYY.nc</p>
</div>
<div class="section level3">
<h3 id="dockerization">Dockerization<a class="anchor" aria-label="anchor" href="#dockerization"></a>
</h3>
<p>The PEcAn system is leveraging Docker to encapsulate most of the code. This will make it easier to share new model with others, without them having to compile the models. The goal is for people to be able to launch the model in docker, and it will register with PEcAn and is almost immediatly available to be used. To accomplish this you will need to modify two files.</p>
<ul>
<li><code>Dockerfile</code></li>
</ul>
<p>The <a href="https://docs.docker.com/engine/reference/builder/" class="external-link">Dockerfile</a> is like the Makefile for docker. This file is split in two pieces the part at the top is to actually build the binary. This is where you specify all the libraries that are needed, as well as all the build tools to compile your model. The second part, starting at the second <code>FROM</code> line, is where you will install only the libraries needed to run the binary and copy the binary from the build stage, using the <code>COPY --from</code> line.</p>
<ul>
<li><code>model_info.json</code></li>
</ul>
<p>The model_info.json describes the model and is used to register the model with PEcAn. In the model_info.json the only fields that are really required are those at the top: <code>name</code>, <code>type</code>, <code>version</code> and <code>binary</code>. All other fields are optional but are good to be filled out. You can leave <code>version</code> and <code>binary</code> with the special values which will be updated by the Dockerfile.</p>
<p>Once the image can be build it can be pushed so others can leverage of the model. For PEcAn we have been using the following naming scheme for the docker images: <code>pecan/model-&lt;model&gt;-&lt;model_version&gt;:&lt;pecan_version&gt;</code> where the <code>model</code> and <code>model_version</code> are the same as those used to build the model, and <code>pecan_version</code> is the version of PEcAn this model is compiled for.</p>
</div>
<div class="section level3">
<h3 id="additional-changes">Additional Changes<a class="anchor" aria-label="anchor" href="#additional-changes"></a>
</h3>
<ul>
<li><code>README.md</code></li>
</ul>
<p>This file should contain basic background information about the model. At a minimum, this should include the scientific motivation and scope, name(s) of maintainer(s), links to project homepage, and a list of a few key publications. relevant publications.</p>
<ul>
<li><code>/tests/testthat/</code></li>
</ul>
<p>Each package should have tests that cover the key functions of the package, at a minimum, the three functions above.</p>
<ul>
<li>documentation</li>
</ul>
<p>Update the <code>NAMESPACE</code>, <code>DESCRIPTION</code> and <code>man/*.Rd</code> files by running</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="op">(</span><span class="st">"models/&lt;modelname&gt;/"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/PecanProject/pecan/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/BSD-3-Clause" class="external-link">BSD_3_clause</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing PEcAn.ModelName</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Jane Doe <br><small class="roles"> Author, maintainer </small>  </li>
<li>John Doe <br><small class="roles"> Author </small>  </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jane Doe, John Doe.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
