<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Generating Priors based on Data and / or Expert knowledge • PEcAn.priors</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generating Priors based on Data and / or Expert knowledge">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PEcAn.priors</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.4.9000</small>

    <a href="../index.html" style="padding: 0em 1em">← Up</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/priors_demo.html">Generating Priors based on Data and / or Expert knowledge</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Generating Priors based on Data and / or Expert knowledge</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/PecanProject/pecan/blob/develop/modules/priors/vignettes/priors_demo.Rmd" class="external-link"><code>vignettes/priors_demo.Rmd</code></a></small>
      <div class="d-none name"><code>priors_demo.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="fitting-priors-to-data-point-estimates-all-grass-species-in-glopnet-">Fitting priors to data (point estimates, all grass species in
GLOPNET).<a class="anchor" aria-label="anchor" href="#fitting-priors-to-data-point-estimates-all-grass-species-in-glopnet-"></a>
</h2>
<div class="section level3">
<h3 id="example-specific-leaf-area-based-on-all-grasses">Example: Specific Leaf Area based on all grasses<a class="anchor" aria-label="anchor" href="#example-specific-leaf-area-based-on-all-grasses"></a>
</h3>
<p>First we are going to set up initial values.</p>
</div>
<div class="section level3">
<h3 id="mle-fit-to-glopnet-specific-leaf-area-data">MLE Fit to glopnet Specific Leaf Area data<a class="anchor" aria-label="anchor" href="#mle-fit-to-glopnet-specific-leaf-area-data"></a>
</h3>
<p>The <a href="https://github.com/PecanProject/pecan/blob/main/modules/priors/R/priors.R" class="external-link"><code>PEcAn.priors::fit.dist</code></a>
helps to choose the best fit parameter distribution given some sample
datasets.</p>
<p><img src="priors_demo_files/figure-html/unnamed-chunk-2-1.png" width="768"><img src="priors_demo_files/figure-html/unnamed-chunk-2-2.png" width="768"></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glopnet.grass</span> <span class="op">&lt;-</span> <span class="va">glopnet.data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">glopnet.data</span><span class="op">$</span><span class="va">GF</span> <span class="op">==</span> <span class="st">'G'</span><span class="op">)</span>, <span class="op">]</span> <span class="co"># GF = growth form; G=grass </span></span>
<span></span>
<span><span class="co">## turnover time (tt)</span></span>
<span><span class="va">glopnet.grass</span><span class="op">$</span><span class="va">tt</span>    <span class="op">&lt;-</span> <span class="fl">12</span><span class="op">/</span><span class="fl">10</span><span class="op">^</span><span class="op">(</span><span class="va">glopnet.grass</span><span class="op">$</span><span class="va">log.LL</span><span class="op">)</span></span>
<span><span class="va">ttdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>tt <span class="op">=</span> <span class="va">glopnet.grass</span><span class="op">$</span><span class="va">tt</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">glopnet.grass</span><span class="op">$</span><span class="va">tt</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">## specific leaf area</span></span>
<span><span class="co">##glopnet.grass$sla   &lt;- 1000/ (0.48 * 10^glopnet.grass$log.LMA)</span></span>
<span><span class="va">glopnet.grass</span><span class="op">$</span><span class="va">sla</span>   <span class="op">&lt;-</span> <span class="fl">1000</span><span class="op">/</span> <span class="op">(</span><span class="fl">10</span><span class="op">^</span><span class="va">glopnet.grass</span><span class="op">$</span><span class="va">log.LMA</span><span class="op">)</span></span>
<span><span class="va">sladata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sla <span class="op">=</span> <span class="va">glopnet.grass</span><span class="op">$</span><span class="va">sla</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">glopnet.grass</span><span class="op">$</span><span class="va">sla</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>The <code>fit.dist</code> function takes a vector of point estimates
(in this case 125 observations of Specific Leaf Area from GLOPNET
database are stored in <code>sladata</code>.</p>
<p>First, it prints out the fits of a subset of distributions (the ‘f’
distribution could not be fit). Second, it prints the</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dists</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'gamma'</span>, <span class="st">'lognormal'</span>,<span class="st">'weibull'</span>, <span class="st">'f'</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/fit.dist.html">fit.dist</a></span><span class="op">(</span><span class="va">sladata</span>, <span class="va">dists</span> <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              a      b     AIC</span></span>
<span><span class="co">## weibull   2.06 19.000 888.759</span></span>
<span><span class="co">## lognormal 2.65  0.677 923.220</span></span>
<span><span class="co">## gamma     2.95  0.175 899.403</span></span></code></pre>
<pre><code><span><span class="co">##   distribution    a  b   n</span></span>
<span><span class="co">## 1      weibull 2.06 19 125</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior.dists</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="st">'SLA'</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit.dist.html">fit.dist</a></span><span class="op">(</span><span class="va">sladata</span>, <span class="va">dists</span> <span class="op">)</span>, </span>
<span>                     <span class="st">'leaf_turnover_rate'</span> <span class="op">=</span> <span class="fu"><a href="../reference/fit.dist.html">fit.dist</a></span><span class="op">(</span><span class="va">ttdata</span>, <span class="va">dists</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              a      b     AIC</span></span>
<span><span class="co">## weibull   2.06 19.000 888.759</span></span>
<span><span class="co">## lognormal 2.65  0.677 923.220</span></span>
<span><span class="co">## gamma     2.95  0.175 899.403</span></span>
<span><span class="co">##              a     b     AIC</span></span>
<span><span class="co">## weibull   1.83 5.180 187.125</span></span>
<span><span class="co">## lognormal 1.35 0.687 195.072</span></span>
<span><span class="co">## gamma     2.90 0.630 187.098</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slaprior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">prior.dists</span><span class="op">[</span><span class="st">'SLA'</span>,<span class="op">]</span>, <span class="fu"><a href="../reference/pr.dens.html">pr.dens</a></span><span class="op">(</span><span class="va">distribution</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ttprior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">prior.dists</span><span class="op">[</span><span class="st">'leaf_turnover_rate'</span>,<span class="op">]</span>, <span class="fu"><a href="../reference/pr.dens.html">pr.dens</a></span><span class="op">(</span><span class="va">distribution</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The <code>priorfig</code> function visualizes the chosen prior
(line), with its mean and 95%CI (dots) as well as the data used to
generate the figure.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior.figures</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">prior.figures</span><span class="op">[[</span><span class="st">'SLA'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/priorfig.html">priorfig</a></span><span class="op">(</span></span>
<span>  priordata <span class="op">=</span> <span class="va">sladata</span>, </span>
<span>  priordensity <span class="op">=</span> <span class="va">slaprior</span>, </span>
<span>  trait <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"SLA"</span>, figid <span class="op">=</span> <span class="st">"SLA"</span>, units<span class="op">=</span><span class="st">"1"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">prior.figures</span><span class="op">[[</span><span class="st">'leaf_turnover_rate'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/priorfig.html">priorfig</a></span><span class="op">(</span></span>
<span>  priordata <span class="op">=</span> <span class="va">ttdata</span>, </span>
<span>  priordensity <span class="op">=</span> <span class="va">ttprior</span>, </span>
<span>  trait <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"leaf_turnover_rate"</span>, figid <span class="op">=</span> <span class="st">"left_turnover_rate"</span>, units<span class="op">=</span><span class="st">"yr-1"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prior.figures</span></span></code></pre></div>
<pre><code><span><span class="co">## $SLA</span></span></code></pre>
<p><img src="priors_demo_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## $leaf_turnover_rate</span></span></code></pre>
<p><img src="priors_demo_files/figure-html/unnamed-chunk-6-2.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="fitting-priors-to-data-with-uncertainty-estimates-generating-posterior-predictive-distribution-of-an-unobserved-c4-grass-species-based-on-values-collected-from-many-pfts-">Fitting priors to data with uncertainty estimates (generating
posterior predictive distribution of an unobserved C4 grass species
based on values collected from many PFTs.<a class="anchor" aria-label="anchor" href="#fitting-priors-to-data-with-uncertainty-estimates-generating-posterior-predictive-distribution-of-an-unobserved-c4-grass-species-based-on-values-collected-from-many-pfts-"></a>
</h2>
<div class="section level3">
<h3 id="vcmax-data-from-wullschleger-1993">Vcmax data from Wullschleger (1993)<a class="anchor" aria-label="anchor" href="#vcmax-data-from-wullschleger-1993"></a>
</h3>
</div>
<div class="section level3">
<h3 id="classify-wullschleger-data-into-functional-types">Classify Wullschleger Data into Functional Types<a class="anchor" aria-label="anchor" href="#classify-wullschleger-data-into-functional-types"></a>
</h3>
<div class="section level4">
<h4 id="query-functional-types-from-bety">1. query functional types from BETY<a class="anchor" aria-label="anchor" href="#query-functional-types-from-bety"></a>
</h4>
<p>This code is not run here - data are provided in .csv file below.
This code requires connection to the BETYdb MySQL server.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wullschleger.species</span> <span class="op">&lt;-</span> <span class="fu">vecpaste</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">wullschleger.data</span><span class="op">$</span><span class="va">AcceptedSymbol</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## load functional type data from BETY</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span><span class="fu">query.bety.con</span><span class="op">(</span>username <span class="op">=</span> <span class="st">"bety"</span>, password <span class="op">=</span> <span class="st">"bety"</span>, </span>
<span>                                   host <span class="op">=</span> <span class="st">"localhost"</span>, dbname <span class="op">=</span> <span class="st">"bety"</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="va">functional.data</span> <span class="op">&lt;-</span> <span class="fu">query.bety</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"select distinct AcceptedSymbol, scientificname, GrowthHabit, Category from species where AcceptedSymbol in ("</span>, <span class="va">wullschleger.species</span>, <span class="st">") and GrowthHabit is not NULL and Category is not NULL;"</span><span class="op">)</span>, <span class="fu">con</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">functional.data</span>, <span class="st">'inst/extdata/wullschleger_join_usdaplants.csv'</span><span class="op">)</span></span></code></pre></div>
<p>Picking up with the Wullschleger dataset joined to USDA Plants
functional type classifications …</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wullschleger.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/wullschleger1993updated.csv'</span>, package <span class="op">=</span> <span class="st">'PEcAn.priors'</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">functional.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/wullschleger_join_usdaplants.csv'</span>, package <span class="op">=</span> <span class="st">'PEcAn.priors'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">subshrubs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">wullschleger.data</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">'Shrub'</span>,<span class="va">wullschleger.data</span><span class="op">$</span><span class="va">GrowthHabit</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">'Subshrub'</span>, <span class="va">wullschleger.data</span><span class="op">$</span><span class="va">GrowthHabit</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">########## 2. Merge functional type information into Wullschleger data</span></span>
<span><span class="va">wullschleger.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">wullschleger.data</span>, <span class="va">functional.data</span>, by <span class="op">=</span> <span class="st">'AcceptedSymbol'</span><span class="op">)</span></span>
<span><span class="co">########## 3. Classify by functional type</span></span>
<span><span class="co">## grass: any Graminoid Monocot</span></span>
<span><span class="va">grass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">wullschleger.data</span>, <span class="va">GrowthHabit</span> <span class="op">==</span> <span class="st">'Graminoid'</span> <span class="op">&amp;</span> <span class="va">Category</span> <span class="op">==</span> <span class="st">'Monocot'</span><span class="op">)</span></span>
<span><span class="co">## forbs/herbs = forb</span></span>
<span><span class="va">forb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">wullschleger.data</span>, <span class="va">GrowthHabit</span> <span class="op">==</span> <span class="st">'Forb/herb'</span> <span class="op">|</span> <span class="va">GrowthHabit</span> <span class="op">==</span> <span class="st">'Vine, Forb/herb'</span><span class="op">)</span></span>
<span><span class="co">## woody = Shrubs, Subshrubs or Trees, add category to a few with missing information, </span></span>
<span><span class="va">woody</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">wullschleger.data</span>, <span class="va">scientificname</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Acacia ligulata'</span>, <span class="st">'Acacia mangium'</span>, <span class="st">'Arbutus unedo'</span>, <span class="st">'Eucalyptus pauciflora'</span>, <span class="st">'Malus'</span>, <span class="st">'Salix'</span><span class="op">)</span> <span class="op">|</span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">wullschleger.data</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">'Shrub'</span>, <span class="va">GrowthHabit</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">'Subshrub'</span>, <span class="va">GrowthHabit</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">'Tree'</span>, <span class="va">GrowthHabit</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## gymnosperms</span></span>
<span><span class="va">gymnosperm</span> <span class="op">&lt;-</span> <span class="va">wullschleger.data</span><span class="op">$</span><span class="va">Category</span> <span class="op">==</span> <span class="st">'Gymnosperm'</span></span>
<span><span class="co">## ambiguous is both woody and herbaceous, will drop</span></span>
<span><span class="va">ambiguous</span> <span class="op">&lt;-</span> <span class="va">wullschleger.data</span><span class="op">$</span><span class="va">GrowthHabit</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Subshrub, Shrub, Forb/herb, Tree"</span>, <span class="st">"Tree, Subshrub, Shrub"</span>, <span class="st">"Tree, Shrub, Subshrub, Forb/herb"</span>, <span class="st">"Subshrub, Forb/herb"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wullschleger.data</span><span class="op">$</span><span class="va">functional.type</span><span class="op">[</span><span class="va">grass</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">wullschleger.data</span><span class="op">$</span><span class="va">functional.type</span><span class="op">[</span><span class="va">forb</span><span class="op">]</span>  <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">wullschleger.data</span><span class="op">$</span><span class="va">functional.type</span><span class="op">[</span><span class="va">woody</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">gymnosperm</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">wullschleger.data</span><span class="op">$</span><span class="va">functional.type</span><span class="op">[</span><span class="va">woody</span> <span class="op">&amp;</span> <span class="va">gymnosperm</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">wullschleger.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">wullschleger.data</span>, <span class="op">!</span><span class="va">ambiguous</span><span class="op">)</span>     </span>
<span></span>
<span><span class="co">############# Estimating SE and n ##################################</span></span>
<span><span class="co">##verr, jerr: the "asymptotic" errors for Vcmax, Jmax using SAS nlim</span></span>
<span><span class="co">##vucl,vlcl,jlcl,jucl: are upper and lower confidence limits of 95%CI</span></span>
<span></span>
<span><span class="co">##Calculate SD as (1/2 the 95%CI)/1.96</span></span>
<span><span class="va">wullschleger.data</span><span class="op">$</span><span class="va">vsd</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">wullschleger.data</span><span class="op">$</span><span class="va">vucl</span><span class="op">-</span><span class="va">wullschleger.data</span><span class="op">$</span><span class="va">vlcl</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="fl">1.96</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##Calculate effective N as (SE/SD)^2 + 1</span></span>
<span><span class="va">wullschleger.data</span><span class="op">$</span><span class="va">neff</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">wullschleger.data</span><span class="op">$</span><span class="va">vse</span><span class="op">/</span><span class="va">wullschleger.data</span><span class="op">$</span><span class="va">vsd</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="va">wullschleger.data</span><span class="op">$</span><span class="va">se</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">wullschleger.data</span><span class="op">$</span><span class="va">vsd</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">wullschleger.data</span><span class="op">$</span><span class="va">neff</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## recode species to numeric</span></span>
<span><span class="va">species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">wullschleger.data</span><span class="op">$</span><span class="va">scientificname</span><span class="op">)</span></span>
<span><span class="va">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">wullschleger.data</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">sp</span><span class="op">[</span><span class="va">wullschleger.data</span><span class="op">$</span><span class="va">scientificname</span> <span class="op">==</span> <span class="va">species</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">i</span></span>
<span><span class="op">}</span> </span>
<span></span>
<span><span class="co">############# Scale values to 25C ##################################</span></span>
<span><span class="va">wullschleger.data</span><span class="op">$</span><span class="va">corrected.vcmax</span> <span class="op">&lt;-</span> <span class="fu">PEcAn.utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PEcAn.utils/man/arrhenius.scaling.html" class="external-link">arrhenius.scaling</a></span><span class="op">(</span></span>
<span>  <span class="va">wullschleger.data</span><span class="op">$</span><span class="va">vcmax</span>, </span>
<span>  old.temp <span class="op">=</span> <span class="va">wullschleger.data</span><span class="op">$</span><span class="va">temp</span>, </span>
<span>  new.temp <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span>
<span></span>
<span><span class="co">############# Create data.frame for JAGS model ##################################</span></span>
<span><span class="va">wullschleger.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Y  <span class="op">=</span> <span class="va">wullschleger.data</span><span class="op">$</span><span class="va">corrected.vcmax</span>,</span>
<span>                                obs.prec <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">wullschleger.data</span><span class="op">$</span><span class="va">neff</span><span class="op">)</span> <span class="op">*</span> <span class="va">wullschleger.data</span><span class="op">$</span><span class="va">se</span><span class="op">)</span>,</span>
<span>                                sp <span class="op">=</span> <span class="va">sp</span>,</span>
<span>                                ft <span class="op">=</span> <span class="va">wullschleger.data</span><span class="op">$</span><span class="va">functional.type</span>,</span>
<span>                                n  <span class="op">=</span> <span class="va">wullschleger.data</span><span class="op">$</span><span class="va">neff</span><span class="op">)</span></span>
<span><span class="co">## Summarize data by species</span></span>
<span><span class="va">wullschleger.vcmax</span> <span class="op">&lt;-</span> <span class="va">wullschleger.data</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">sp</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">summarise</span><span class="op">(</span>Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span>, </span>
<span>            obs.prec <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">obs.prec</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            ft <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ft</span><span class="op">)</span>, <span class="co"># identity</span></span>
<span>            n <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">sp</span><span class="op">)</span></span></code></pre></div>
<div class="section level5">
<h5 id="add-data-from-c4-species">Add data from C4 species<a class="anchor" aria-label="anchor" href="#add-data-from-c4-species"></a>
</h5>
<p>Few measurements of Vcmax for C4 species were available. ######
Miscanthus: Wang D, Maughan MW, Sun J, Feng X, Miguez FE, Lee DK, Dietze
MC, 2011. Impact of canopy nitrogen allocation on growth and
photosynthesis of miscanthus (Miscanthus x giganteus). Oecologia, in
press</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dwang.vcmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">19.73</span>, <span class="fl">40.35</span>, <span class="fl">33.02</span>, <span class="fl">21.28</span>, <span class="fl">31.45</span>, <span class="fl">27.83</span>, <span class="fl">9.69</span>, <span class="fl">15.99</span>, <span class="fl">18.88</span>, <span class="fl">11.45</span>, <span class="fl">15.81</span>, <span class="fl">27.61</span>, <span class="fl">13</span>, <span class="fl">21.25</span>, <span class="fl">22.01</span>, <span class="fl">10.37</span>, <span class="fl">12.37</span>, <span class="fl">22.8</span>, <span class="fl">12.24</span>, <span class="fl">15.85</span>, <span class="fl">21.93</span>, <span class="fl">23.48</span>, <span class="fl">31.51</span>, <span class="fl">23.16</span>, <span class="fl">18.55</span>, <span class="fl">17.06</span>, <span class="fl">20.27</span>, <span class="fl">30.41</span><span class="op">)</span></span>
<span><span class="va">dwang.vcmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">dwang.vcmax</span><span class="op">)</span>, </span>
<span>                          obs.prec <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">dwang.vcmax</span><span class="op">)</span>,</span>
<span>                          ft <span class="op">=</span> <span class="fl">2</span>,         <span class="co">#C4 Grass</span></span>
<span>                          n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dwang.vcmax</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level6">
<h6 id="muhlenbergia-glomerata">Muhlenbergia glomerata<a class="anchor" aria-label="anchor" href="#muhlenbergia-glomerata"></a>
</h6>
<p>Kubien and Sage 2004. Low-temperature photosynthetic performance of a
C4 grass and a co-occurring C3 grass native to high latitudes. Plant,
Cell &amp; Environment DOI: 10.1111/j.1365-3040.2004.01196.x</p>
<p>Data from figure 5 in Kubien and Sage (2004), average across plants
grown at 14/10 degrees and 26/22 degrees</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kubien.vcmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fl">23.4</span>, <span class="fl">24.8</span><span class="op">)</span>, </span>
<span>                           obs.prec <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">2.6</span><span class="op">^</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">2.5</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>                           n <span class="op">=</span> <span class="fl">8</span>, </span>
<span>                           ft <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>                      </span></code></pre></div>
</div>
<div class="section level6">
<h6 id="zea-mays-corn">Zea Mays (Corn)<a class="anchor" aria-label="anchor" href="#zea-mays-corn"></a>
</h6>
<p>Massad, Tuzet, Bethenod 2007. The effect of temperature on C4-type
leaf photosynthesis parameters. Plant, Cell &amp; Environment 30(9)
1191-1204. DOI: 10.1111/j.1365-3040.2007.01691.x</p>
<p>data from fig 6a</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">massad.vcmax.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>vcmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">17.1</span>, <span class="fl">17.2</span>, <span class="fl">17.6</span>, <span class="fl">18</span>, <span class="fl">18.3</span>, <span class="fl">18.5</span>, <span class="fl">20.4</span>, <span class="fl">22.9</span>, <span class="fl">22.9</span>, <span class="fl">21.9</span>, <span class="fl">21.8</span>, <span class="fl">22.7</span>, <span class="fl">22.3</span>, <span class="fl">25.3</span>, <span class="fl">24.4</span>, <span class="fl">25.5</span>, <span class="fl">25.5</span>, <span class="fl">24.9</span>, <span class="fl">31.2</span>, <span class="fl">30.8</span>, <span class="fl">31.6</span>, <span class="fl">31.7</span>, <span class="fl">32.5</span>, <span class="fl">34.1</span>, <span class="fl">34.2</span>, <span class="fl">33.9</span>, <span class="fl">35.4</span>, <span class="fl">36</span>, <span class="fl">36</span>, <span class="fl">37.5</span>, <span class="fl">38.2</span>, <span class="fl">38.1</span>, <span class="fl">37.4</span>, <span class="fl">37.7</span>, <span class="fl">25.2</span>, <span class="fl">25.5</span><span class="op">)</span>, </span>
<span>                                temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20.5</span>, <span class="fl">24.6</span>, <span class="fl">21</span>, <span class="fl">19</span>, <span class="fl">21.9</span>, <span class="fl">15</span>, <span class="fl">19.6</span>, <span class="fl">14.3</span>, <span class="fl">20.8</span>, <span class="fl">23.4</span>, <span class="fl">24.8</span>, <span class="fl">25.9</span>, <span class="fl">24.1</span>, <span class="fl">22.8</span>, <span class="fl">27.9</span>, <span class="fl">31.7</span>, <span class="fl">35.5</span>, <span class="fl">39.3</span>, <span class="fl">37.9</span>, <span class="fl">42.4</span>, <span class="fl">41.5</span>, <span class="fl">48.7</span>, <span class="fl">33.3</span>, <span class="fl">33.3</span>, <span class="fl">31.5</span>, <span class="fl">39.1</span>, <span class="fl">38.8</span>, <span class="fl">43.3</span>, <span class="fl">50</span>, <span class="fl">38.4</span>, <span class="fl">35.7</span>, <span class="fl">34.4</span>, <span class="fl">31.9</span>, <span class="fl">33.9</span>, <span class="fl">32.1</span>, <span class="fl">33.7</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">massad.vcmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span></span>
<span>  <span class="va">massad.vcmax.data</span>,</span>
<span>  <span class="fu">PEcAn.utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/PEcAn.utils/man/arrhenius.scaling.html" class="external-link">arrhenius.scaling</a></span><span class="op">(</span></span>
<span>    old.temp <span class="op">=</span> <span class="va">temp</span>, </span>
<span>    new.temp <span class="op">=</span> <span class="fl">25</span>, </span>
<span>    observed.value <span class="op">=</span> <span class="va">vcmax</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">massad.vcmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Y  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">massad.vcmax</span><span class="op">)</span>,</span>
<span>                           obs.prec <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">massad.vcmax</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                           n  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">massad.vcmax</span><span class="op">)</span>,</span>
<span>                           ft <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co">##### Combine all data sets</span></span>
<span><span class="va">all.vcmax.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">wullschleger.vcmax</span>,</span>
<span>                        <span class="va">dwang.vcmax</span>, </span>
<span>                        <span class="co">## xfeng.vcmax, </span></span>
<span>                        <span class="va">kubien.vcmax</span>, </span>
<span>                        <span class="va">massad.vcmax</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level5">
<h5 id="take-a-look-at-the-raw-data-by-functional-type">take a look at the raw data by functional type:<a class="anchor" aria-label="anchor" href="#take-a-look-at-the-raw-data-by-functional-type"></a>
</h5>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">all.vcmax.data</span>, <span class="fu">aes</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">ft</span><span class="op">)</span>, <span class="va">Y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">'Plant Functional Type'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">'Vcmax'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="priors_demo_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
<div class="section level5">
<h5 id="add-unobserved-c4-species-so-jags-calculates-posterior-predictive-distribution">Add unobserved C4 species so JAGS calculates posterior predictive
distribution<a class="anchor" aria-label="anchor" href="#add-unobserved-c4-species-so-jags-calculates-posterior-predictive-distribution"></a>
</h5>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vcmax.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">all.vcmax.data</span>, </span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="cn">NA</span>, obs.prec <span class="op">=</span> <span class="cn">NA</span>, ft <span class="op">=</span> <span class="fl">2</span>, n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="write-and-run-meta-analysis">Write and Run Meta-analysis<a class="anchor" aria-label="anchor" href="#write-and-run-meta-analysis"></a>
</h5>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span>con <span class="op">=</span> <span class="st">"vcmax.prior.bug"</span>, </span>
<span>           text <span class="op">=</span>  <span class="st">"model{  </span></span>
<span><span class="st">             for (k in 1:length(Y)){</span></span>
<span><span class="st">               Y[k]  ~ dnorm(beta.ft[ft[k]], tau.y[k])T(0,)</span></span>
<span><span class="st">               tau.y[k] &lt;- prec.y*n[k]</span></span>
<span><span class="st">               u1[k] &lt;- n[k]/2                             </span></span>
<span><span class="st">               u2[k] &lt;- n[k]/(2*prec.y)</span></span>
<span><span class="st">               obs.prec[k] ~ dgamma(u1[k], u2[k])</span></span>
<span><span class="st">             }</span></span>
<span><span class="st">             for (f in 1:5){</span></span>
<span><span class="st">               beta.ft[f] ~ dnorm(0, tau.ft)</span></span>
<span><span class="st">             }</span></span>
<span><span class="st">             tau.ft ~ dgamma(0.1, 0.1)</span></span>
<span><span class="st">             prec.y    ~ dgamma(0.1, 0.1)     </span></span>
<span><span class="st">             sd.y      &lt;- 1 / sqrt(prec.y)</span></span>
<span><span class="st">             ## estimating posterior predictive for new C4 species</span></span>
<span><span class="st">             pi.pavi &lt;- Y[length(Y)]         </span></span>
<span><span class="st">             diff &lt;- beta.ft[1] - beta.ft[2]</span></span>
<span><span class="st">           }"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mcmc-jags.sourceforge.io" class="external-link">rjags</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: coda</span></span></code></pre>
<pre><code><span><span class="co">## Linked to JAGS 4.3.2</span></span></code></pre>
<pre><code><span><span class="co">## Loaded modules: basemod,bugs</span></span></code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">j.model</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rjags/man/jags.model.html" class="external-link">jags.model</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"vcmax.prior.bug"</span>, </span>
<span>                       data <span class="op">=</span> <span class="va">vcmax.data</span>, </span>
<span>                       n.adapt <span class="op">=</span> <span class="fl">500</span>, </span>
<span>                       n.chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                       inits <span class="op">=</span> <span class="va">inits</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Compiling model graph</span></span>
<span><span class="co">##    Resolving undeclared variables</span></span>
<span><span class="co">##    Allocating nodes</span></span>
<span><span class="co">## Graph information:</span></span>
<span><span class="co">##    Observed stochastic nodes: 194</span></span>
<span><span class="co">##    Unobserved stochastic nodes: 9</span></span>
<span><span class="co">##    Total graph size: 614</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Initializing model</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mcmc.object</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/rjags/man/coda.samples.html" class="external-link">coda.samples</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">j.model</span>, variable.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'pi.pavi'</span>, <span class="st">'beta.ft'</span>, <span class="st">'diff'</span><span class="op">)</span>,</span>
<span>                            n.iter <span class="op">=</span> <span class="va">iter</span><span class="op">)</span></span>
<span><span class="va">mcmc.o</span>     <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/window.html" class="external-link">window</a></span><span class="op">(</span><span class="va">mcmc.object</span>, start <span class="op">=</span> <span class="va">iter</span><span class="op">/</span><span class="fl">2</span>, thin <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">pi.pavi</span>    <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>vcmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">mcmc.o</span><span class="op">[</span>,<span class="st">'pi.pavi'</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">vcmax.dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit.dist.html">fit.dist</a></span><span class="op">(</span><span class="va">pi.pavi</span>, n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">vcmax.data</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              a      b     AIC</span></span>
<span><span class="co">## weibull   3.54 24.300 14780.8</span></span>
<span><span class="co">## lognormal 3.02  0.394 15482.8</span></span>
<span><span class="co">## gamma     8.06  0.367 15082.4</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prior.dists</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">prior.dists</span>, <span class="st">'Vcmax'</span> <span class="op">=</span> <span class="va">vcmax.dist</span><span class="op">)</span></span>
<span><span class="va">vcmax.density</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">vcmax.dist</span>, <span class="fu"><a href="../reference/pr.dens.html">pr.dens</a></span><span class="op">(</span><span class="va">distribution</span>, <span class="va">a</span>, <span class="va">b</span><span class="op">)</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">50</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">######### Vcmax Prior Plot</span></span>
<span><span class="va">vcmax.c4</span> <span class="op">&lt;-</span> <span class="va">all.vcmax.data</span><span class="op">$</span><span class="va">ft</span> <span class="op">==</span> <span class="fl">2</span></span>
<span><span class="va">vcmax.data</span> <span class="op">&lt;-</span> <span class="va">all.vcmax.data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'ft'</span>, <span class="st">'Y'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">vcmax.data</span><span class="op">$</span><span class="va">mean</span> <span class="op">&lt;-</span> <span class="va">vcmax.data</span><span class="op">$</span><span class="va">Y</span></span>
<span><span class="va">vcmax.data</span><span class="op">$</span><span class="va">se</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">all.vcmax.data</span><span class="op">$</span><span class="va">n</span><span class="op">)</span> <span class="op">*</span> <span class="va">all.vcmax.data</span><span class="op">$</span><span class="va">obs.prec</span><span class="op">)</span></span>
<span><span class="va">vcmax.data</span> <span class="op">&lt;-</span> <span class="va">vcmax.data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'ft'</span>, <span class="st">'mean'</span>, <span class="st">'se'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#vcmax.mean &lt;- all.vcmax.data$Y[!c4,]</span></span>
<span><span class="co">#vcmax.se   &lt;- with(all.vcmax.data[!c4,], 1/(sqrt(n) * obs.prec))#[reorder]</span></span>
<span><span class="co">#c4.mean &lt;- all.vcmax.data$Y)[c4]</span></span>
<span><span class="co">#c4.se   &lt;- with(all.vcmax.data, 1 / (sqrt(n) * obs.prec) )[c4]</span></span>
<span></span>
<span><span class="va">prior.figures</span><span class="op">[[</span><span class="st">'Vcmax'</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/priorfig.html">priorfig</a></span><span class="op">(</span>priordensity <span class="op">=</span> <span class="va">vcmax.density</span>, </span>
<span>                                     trait <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">'Vcmax'</span>, figid <span class="op">=</span> <span class="st">'Vcmax'</span>, units <span class="op">=</span> <span class="st">'umol CO2 m-2 s-1'</span><span class="op">)</span>, </span>
<span>                                     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">vcmax.data</span><span class="op">$</span><span class="va">mean</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">vcmax.data</span>, <span class="va">ft</span> <span class="op">!=</span> <span class="fl">2</span><span class="op">)</span>, </span>
<span>             <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">mean</span>, y <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">vcmax.c4</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">vcmax.c4</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">3000</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">'grey60'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">vcmax.data</span>, <span class="va">ft</span> <span class="op">!=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>               <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mean</span> <span class="op">-</span> <span class="va">se</span>, xend <span class="op">=</span> <span class="va">mean</span> <span class="op">+</span> <span class="va">se</span>, </span>
<span>                   y <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">vcmax.c4</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">vcmax.c4</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">3000</span>, </span>
<span>                   yend <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">vcmax.c4</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">vcmax.c4</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">3000</span><span class="op">)</span>,</span>
<span>               color <span class="op">=</span> <span class="st">'grey60'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">## darker color for C4 grasses</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">vcmax.data</span>, <span class="va">ft</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>             <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">mean</span>, y <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">vcmax.c4</span><span class="op">)</span><span class="op">/</span><span class="fl">2000</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">vcmax.data</span>, <span class="va">ft</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>               <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">mean</span> <span class="op">-</span> <span class="va">se</span>, xend <span class="op">=</span> <span class="va">mean</span> <span class="op">+</span> <span class="va">se</span>, </span>
<span>                   y <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">vcmax.c4</span><span class="op">)</span><span class="op">/</span><span class="fl">2000</span>, yend <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">vcmax.c4</span><span class="op">)</span><span class="op">/</span><span class="fl">2000</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">prior.figures</span><span class="op">[[</span><span class="st">'Vcmax'</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: Removed 1 row containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_segment()`).</span></span></code></pre>
<p><img src="priors_demo_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>Fitting priors to expert constraint.</p>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="other-examples-approaches">Other Examples / Approaches<a class="anchor" aria-label="anchor" href="#other-examples-approaches"></a>
</h2>
<div class="section level3">
<h3 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h3>
<ul>
<li>Estimating priors for the DALEC model in <a href="https://github.com/PecanProject/pecan/blob/main/models/dalec/inst/DALEC_priors.R" class="external-link">models/dalec/inst/DALEC_priors.R</a>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="package-rriskdistributions">Package <code>rriskDistributions</code><a class="anchor" aria-label="anchor" href="#package-rriskdistributions"></a>
</h3>
<p>The <a href="http://cran.r-project.org/web/packages/rriskDistributions/index.html" class="external-link">rriskDistributions</a>
useful for estimating priors …</p>
<p>as well as individual functions for each distribution such as
<code>get.&lt;somedist&gt;.par</code> that provide nice diagnostic plots
(e.g. compare chosen points to cdf) for example, to compute the
parameters of a Gamma distribution that fits a median of 2.5 and has a
95%CI of [1, 10]:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.bfr.bund.de/cd/52158" class="external-link">rriskDistributions</a></span><span class="op">)</span></span>
<span><span class="fu">get.gamma.par</span><span class="op">(</span>p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.50</span>, <span class="fl">0.975</span><span class="op">)</span>, q <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2.5</span>, <span class="fl">10</span><span class="op">)</span>, tol <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p>The function <code>fit.pecr</code> provides a GUI to explore the fits
of a range of distributions, e.g.:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fit.perc</span><span class="op">(</span>p <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span><span class="op">)</span>, q <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">60</span>, <span class="fl">90</span><span class="op">)</span>, tolConv <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p>produces this:</p>
<div class="float">
<img src="https://dl.dropboxusercontent.com/u/18092793/fit.perc_example.PNG" alt="image of rriskDistributions example that uses GUI"><div class="figcaption">image of rriskDistributions example that uses
GUI</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by David LeBauer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
