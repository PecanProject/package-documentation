<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Fitting Hierarchical Bayes photosynthetic response curves • PEcAn.photosynthesis</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fitting Hierarchical Bayes photosynthetic response curves">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">PEcAn.photosynthesis</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.4.9000</small>

    <a href="../index.html" style="padding: 0em 1em">← Up</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ResponseCurves.html">Fitting Hierarchical Bayes photosynthetic response curves</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fitting Hierarchical Bayes photosynthetic response curves</h1>
                        <h4 data-toc-skip class="author">Mike
Dietze</h4>
            
            <h4 data-toc-skip class="date">June 25, 2015</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/PecanProject/pecan/blob/develop/modules/photosynthesis/vignettes/ResponseCurves.Rmd" class="external-link"><code>vignettes/ResponseCurves.Rmd</code></a></small>
      <div class="d-none name"><code>ResponseCurves.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This package is designed to fit the Farquhar, von Caemmerer, and
Berry (1980) photosynthesis model [FvCB model] to leaf-level
photosynthetic data. The statistical model generalizes the Hierarchial
Bayesian approach described in Feng and Dietze (2013). The important
advance that this approach provides is the ability to include covariates
(e.g. leaf traits) in a mixed effects model describing key model
parameters,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>V</mi><mtext mathvariant="normal">cmax</mtext></msub><annotation encoding="application/x-tex">V_\textrm{cmax}</annotation></semantics></math>.
At the moment the only supported random effect is a leaf-level effect,
however fixed effects can be specified using standard R linear model
notation, including interaction terms.</p>
<p>This package includes functions for: loading photosynthetic data in
the common LI-COR text-based format, performing visual QA/QC on that
data, fitting the model to data, and generating diagnostic
response-curve plots with confidence and predictive intervals. The
diagnostic and QA/QC functions assume that data was collected as CO2 and
light response curves (A-Ci and A-Q respectively). This assumption is
not required for model fitting, so alternative sampling designs are
allowed, as described by Dietze (2014).</p>
<p>The version of the FvCB model used is described below, and at the
moment does not include the TPU limitation term or temperature
corrections (i.e. all data are assumed to be collected at the same leaf
temperature, all parameters are specific to that temperature). It also
assumes that electron transport rate, J, is a saturating function of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>J</mi><mtext mathvariant="normal">max</mtext></msub><annotation encoding="application/x-tex">J_{\textrm{max}}</annotation></semantics></math>.</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mi>j</mi></msub><mo>=</mo><mfrac><mrow><mi>α</mi><mi>Q</mi></mrow><msqrt><mrow><mn>1</mn><mo>+</mo><mo stretchy="false" form="prefix">(</mo><msup><mi>α</mi><mn>2</mn></msup><msup><mi>Q</mi><mn>2</mn></msup><mo stretchy="false" form="postfix">)</mo><mi>/</mi><mo stretchy="false" form="prefix">(</mo><msubsup><mi>J</mi><mtext mathvariant="normal">max</mtext><mn>2</mn></msubsup><mo stretchy="false" form="postfix">)</mo></mrow></msqrt></mfrac><mfrac><mrow><msub><mi>C</mi><mi>i</mi></msub><mo>−</mo><mi mathvariant="normal">Γ</mi></mrow><mrow><mn>4</mn><msub><mi>C</mi><mi>i</mi></msub><mo>+</mo><mn>8</mn><mi mathvariant="normal">Γ</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">A_j = \frac{\alpha Q}{\sqrt{1+(\alpha^2 Q^2)/(J_\textrm{max}^2)}} \frac{C_i- \Gamma}{4 C_i + 8 \Gamma}</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mi>c</mi></msub><mo>=</mo><msub><mi>V</mi><mtext mathvariant="normal">cmax</mtext></msub><mfrac><mrow><msub><mi>C</mi><mi>i</mi></msub><mo>−</mo><mi mathvariant="normal">Γ</mi></mrow><mrow><msub><mi>C</mi><mi>i</mi></msub><mo>+</mo><msub><mi>K</mi><mi>C</mi></msub><mo stretchy="false" form="prefix">(</mo><mn>1</mn><mo>+</mo><mo stretchy="false" form="prefix">[</mo><mi>O</mi><mo stretchy="false" form="postfix">]</mo><mi>/</mi><msub><mi>K</mi><mi>O</mi></msub><mo stretchy="false" form="postfix">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">A_c = V_{\textrm{cmax}} \frac{C_i - \Gamma}{C_i+ K_C (1+[O]/K_O) }</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>A</mi><mrow><mo stretchy="false" form="prefix">(</mo><mi>m</mi><mo stretchy="false" form="postfix">)</mo></mrow></msup><mo>=</mo><mi>m</mi><mi>i</mi><mi>n</mi><mo stretchy="false" form="prefix">(</mo><msub><mi>A</mi><mi>j</mi></msub><mo>,</mo><msub><mi>A</mi><mi>c</mi></msub><mo stretchy="false" form="postfix">)</mo><mo>−</mo><mi>r</mi></mrow><annotation encoding="application/x-tex">A^{(m)} = min(A_j,A_c) - r</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>A</mi><mrow><mo stretchy="false" form="prefix">(</mo><mi>o</mi><mo stretchy="false" form="postfix">)</mo></mrow></msup><mo>∼</mo><mi>N</mi><mo stretchy="false" form="prefix">(</mo><msup><mi>A</mi><mrow><mo stretchy="false" form="prefix">(</mo><mi>m</mi><mo stretchy="false" form="postfix">)</mo></mrow></msup><mo>,</mo><mi>τ</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">A^{(o)} \sim N(A^{(m)},\tau)</annotation></semantics></math></p>
<table class="table">
<colgroup>
<col width="30%">
<col width="36%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th>Parameter</th>
<th>Symbol</th>
<th>Definition</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>alpha0</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></td>
<td>quantum yield (mol electrons/mole photon)</td>
</tr>
<tr class="even">
<td>Jmax</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>J</mi><mtext mathvariant="normal">max</mtext></msub><annotation encoding="application/x-tex">J_{\textrm{max}}</annotation></semantics></math></td>
<td>maximum electron transport</td>
</tr>
<tr class="odd">
<td>cp</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi mathvariant="normal">Γ</mi><annotation encoding="application/x-tex">\Gamma</annotation></semantics></math></td>
<td>CO2 compensation point</td>
</tr>
<tr class="even">
<td>vmax0</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>V</mi><mtext mathvariant="normal">cmax</mtext></msub><annotation encoding="application/x-tex">V_{\textrm{cmax}}</annotation></semantics></math></td>
<td>maximum Rubisco capacity (a.k.a Vcmax)</td>
</tr>
<tr class="odd">
<td>r</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mtext mathvariant="normal">d</mtext></msub><annotation encoding="application/x-tex">R_\textrm{d}</annotation></semantics></math></td>
<td>leaf respiration</td>
</tr>
<tr class="even">
<td>tau</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>τ</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math></td>
<td>residual precision</td>
</tr>
<tr class="odd">
<td>q</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Q</mi><annotation encoding="application/x-tex">Q</annotation></semantics></math></td>
<td>PAR</td>
</tr>
<tr class="even">
<td>pi</td>
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>C</mi><mtext mathvariant="normal">i</mtext></msub><annotation encoding="application/x-tex">C_\textrm{i}</annotation></semantics></math></td>
<td>CO2 concentration</td>
</tr>
</tbody>
</table>
<p>The ‘Parameter’ above refers to how the variable is referenced in the
code, and thus the name that will be returned by the statistical
fit.</p>
<p>The hierarchical version of this model is equivalent to the standard
model except that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>V</mi><mtext mathvariant="normal">cmax</mtext></msub><annotation encoding="application/x-tex">V_\textrm{cmax}</annotation></semantics></math>
are mixed effect linear models of any covariates specified. These linear
models assume uninformative Normal priors, while the random effects and
residual errors are assumed to have Gamma priors on their precisions.
All other priors are as described below in the example code. The FvCB
model is fit using JAGS via the <em>rjags</em> package so outputs are
<em>coda</em> mcmc.list objects that can be assessed and manipulated
using standard tools in the <em>coda</em> package.</p>
</div>
<div class="section level2">
<h2 id="install-package-from-github">Install package from Github<a class="anchor" aria-label="anchor" href="#install-package-from-github"></a>
</h2>
<p>If you have all of PEcAn installed, skip this – PEcAn.photosynthesis
is already installed!</p>
<p>To install only the PEcAn.photosynthesis package, separately from the
rest of PEcAn, run the following in R:</p>
<pre><code><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"PecanProject/pecan/modules/photosynthesis"</span><span class="op">)</span></span></code></pre>
<p>You should only have to do this once.</p>
</div>
<div class="section level2">
<h2 id="load-library-and-example-data">Load library and example data<a class="anchor" aria-label="anchor" href="#load-library-and-example-data"></a>
</h2>
<p>In this example we are using a set of files that are built into the
package, but you could easily replace <em>filenames</em> with vector of
your own filenames, for example using <em>list.files</em> to look up all
the files in a directory</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pecanproject.github.io" class="external-link">PEcAn.photosynthesis</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: rjags</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: coda</span></span></code></pre>
<pre><code><span><span class="co">## Linked to JAGS 4.3.2</span></span></code></pre>
<pre><code><span><span class="co">## Loaded modules: basemod,bugs</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Get list of LI-COR 6400 file names (ASCII not xls)</span></span>
<span><span class="va">filenames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"flux-course-"</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>,each<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"aci"</span>,<span class="st">"aq"</span><span class="op">)</span><span class="op">)</span>, package <span class="op">=</span> <span class="st">"PEcAn.photosynthesis"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Load files to a list</span></span>
<span><span class="va">master</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">filenames</span>, <span class="va">read_Licor</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "flux-course-1aci"</span></span>
<span><span class="co">## [1] "flux-course-1aq"</span></span>
<span><span class="co">## [1] "flux-course-2aci"</span></span>
<span><span class="co">## [1] "flux-course-2aq"</span></span>
<span><span class="co">## [1] "flux-course-3aci"</span></span>
<span><span class="co">## [1] "flux-course-3aq"</span></span>
<span><span class="co">## [1] "flux-course-4aci"</span></span>
<span><span class="co">## [1] "flux-course-4aq"</span></span>
<span><span class="co">## [1] "flux-course-5aci"</span></span>
<span><span class="co">## [1] "flux-course-5aq"</span></span>
<span><span class="co">## [1] "flux-course-6aci"</span></span>
<span><span class="co">## [1] "flux-course-6aq"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="run-qaqc-checks">run QA/QC checks<a class="anchor" aria-label="anchor" href="#run-qaqc-checks"></a>
</h2>
<p>The code below performs a set of interactive QA/QC checks on the
LI-COR data that’s been loaded. Because it’s interactive it isn’t run
when this vignette is knit.</p>
<p>If you want to get a feel for how the code works you’ll want to run
it first on just one file, rather than looping over all the files</p>
<pre><code><span><span class="va">master</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Licor_QC.html">Licor_QC</a></span><span class="op">(</span><span class="va">master</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre>
<p>On the first screen you will be shown an A-Ci curve. Click on points
that are outliers that you want to remove. Be aware that these points
will not change color in <strong>THIS SCREEN</strong>, but will be
updated in the next. Also be aware that if your data set is not an A-Ci
curve (or contains both A-Ci and A-Q curves) there are points that may
look like outliers just because they are data from the other curve. When
you are done selecting outliers, click <strong>[esc]</strong> to move to
the next screen.</p>
<p>The second screen then verifies the status of point selections from
the first screen and gives you an opportunity to unselect points that
had been flagged as ‘fail’.</p>
<p>The third and fourth screens are the equivalent plots for the A-Q
(light response) curves.</p>
<p>Finally, this function returns a copy of the original data with a new
column, “QC”, added. This column will flag all passed values with 1, all
unchecked values with 0, and all failed values with -1.</p>
<p>The function Licor_QC has an optional arguement, <em>curve</em>,
which can be set to either “ACi” or “AQ” if you only want to perform one
of these diagnostics rather than both (which is the default).</p>
<p>Also, the QC code attempts to automatically separate which points are
part of the ACi curve from which parts are part of the AQ curve, based
on how close points are to the the variable which is supposed to be held
constant. The optional variable “tol” controls the tolerance of this
filter, and is expressed as a proportion of the fixed value. The default
value, 0.05, corresponds to a 5% deviation. For example, in the ACi
curve the light level should be held constant so the code filters the
PARi variable to find the mode and then included any data that’s within
5% of the mode in the ACi curve.</p>
<p>Once you have a feel for the QA/QC function, you’ll want to run it
for all the data you’ve loaded.</p>
<pre><code><span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">master</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">master</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="../reference/Licor_QC.html">Licor_QC</a></span><span class="op">(</span><span class="va">master</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="merge-data-into-one-data-frame">Merge data into one data frame<a class="anchor" aria-label="anchor" href="#merge-data-into-one-data-frame"></a>
</h2>
<p>Once data been’s checked we’ll merge it into one large data frame</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">master</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## if QC was done, remove both unchecked points and those that fail QC</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="st">"QC"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">QC</span> <span class="op">&lt;</span> <span class="fl">1</span><span class="op">)</span>,<span class="op">]</span>  </span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">QC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">QC</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="fit-fvcb-model-to-composite-data">Fit FvCB model to composite data<a class="anchor" aria-label="anchor" href="#fit-fvcb-model-to-composite-data"></a>
</h2>
<p>If you only want to fit the model to the data from one leaf you could
do this as</p>
<pre><code><span><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitA.html">fitA</a></span><span class="op">(</span><span class="va">master</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre>
<p>Where the one required argument is the data frame of photosynthetic
data. However, this code also allows use to fit the FvCB model to all of
the data at once.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"fit.RData"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"fit.RData"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span><span class="op">{</span></span>
<span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitA.html">fitA</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">fit</span>, file <span class="op">=</span> <span class="st">"fit.RData"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## Compiling model graph</span></span>
<span><span class="co">##    Resolving undeclared variables</span></span>
<span><span class="co">##    Allocating nodes</span></span>
<span><span class="co">## Graph information:</span></span>
<span><span class="co">##    Observed stochastic nodes: 133</span></span>
<span><span class="co">##    Unobserved stochastic nodes: 139</span></span>
<span><span class="co">##    Total graph size: 2117</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Initializing model</span></span></code></pre>
<p>Because the MCMC can take a bit of time to run, in this example the
code is written to load the existing fit if it exists, which just makes
knitting the vignette more efficient.</p>
<p>The returned object is a list with two mcmc.lists, “params” and
“predict”, and the text of the JAGS model that was fit. We can look at
this model below:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/writeLines.html" class="external-link">writeLines</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   </span></span>
<span><span class="co">## model{</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ## Priors</span></span>
<span><span class="co">##   Jmax0 ~ dlnorm(4.7,2.7)             ## maximum electron transport rate prior</span></span>
<span><span class="co">##   alpha0~dnorm(0.25,100)             ##quantum yield  (mol electrons/mole photon) prior</span></span>
<span><span class="co">##   vmax0 ~dlnorm(4.6,2.7)             ## maximum rubisco capacity prior</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   #Jmax ~ dweibull(2.0,260)          ## maximum electron transport rate prior Serbin 2012</span></span>
<span><span class="co">##   #alpha0 ~ dgamma(2.0,22.0)         ## quantum yield prior Serbin 2012</span></span>
<span><span class="co">##   #vmax0 ~ dweibull(1.7,80)          ## maximum rate of carboxylation prior Serbin 2012</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   r0 ~ dlnorm(0.75,1.56)             ## leaf respiration prior</span></span>
<span><span class="co">##   #r ~ dweibull(2.0,6.0)             ## broad leaf respiration prior for trees</span></span>
<span><span class="co">##   cp0 ~ dlnorm(1.9,2.7)              ## CO2 compensation point prior</span></span>
<span><span class="co">##   tau ~ dgamma(0.1,0.1)</span></span>
<span><span class="co">## #TPU  tpu~ dlnorm(3,2.8)             ##tpu</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ## Constants: Bernacchi et al 2001, PC&amp;E, Table 1</span></span>
<span><span class="co">## R &lt;- 8.3144621 ## gas constant</span></span>
<span><span class="co">## r.c &lt;- 18.72</span></span>
<span><span class="co">## r.H &lt;- 46.39</span></span>
<span><span class="co">## Vc.c &lt;- 26.35</span></span>
<span><span class="co">## Vc.H &lt;- 65.33</span></span>
<span><span class="co">## Vo.c &lt;- 22.98</span></span>
<span><span class="co">## Vo.H &lt;- 60.11</span></span>
<span><span class="co">## cp.c &lt;- 19.02</span></span>
<span><span class="co">## cp.H &lt;- 37.83</span></span>
<span><span class="co">## cp.ref &lt;- 42.75</span></span>
<span><span class="co">## Kc.c &lt;- 38.05</span></span>
<span><span class="co">## Kc.H &lt;- 79.43</span></span>
<span><span class="co">## Kc.ref &lt;- 404.9</span></span>
<span><span class="co">## Ko.c &lt;- 20.30</span></span>
<span><span class="co">## Ko.H &lt;- 36.38</span></span>
<span><span class="co">## Ko.ref &lt;- 278.4</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ## Constants: June et al 2004, Funct Plant Bio</span></span>
<span><span class="co">## Omega &lt;- 18</span></span>
<span><span class="co">## To &lt;- 35    ## Representative value, would benifit from spp calibration!</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ## Vcmax BETAS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## #RLEAF.V  tau.Vleaf~dgamma(0.1,0.1)          ## add random leaf effects</span></span>
<span><span class="co">## #RLEAF.V  for(i in 1:nrep){                  </span></span>
<span><span class="co">## #RLEAF.V   Vleaf[i]~dnorm(0,tau.Vleaf)</span></span>
<span><span class="co">## #RLEAF.V  }</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ## alpha BETAs</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## #RLEAF.A  tau.Aleaf~dgamma(0.1,0.1)</span></span>
<span><span class="co">## #RLEAF.A  for(i in 1:nrep){                  </span></span>
<span><span class="co">## #RLEAF.A   Aleaf[i]~dnorm(0,tau.Aleaf)</span></span>
<span><span class="co">## #RLEAF.A  }</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   for(i in 1:n) {</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##      r[i]  &lt;- r0 ##B01* exp(r.c - r.H/R/T[i])</span></span>
<span><span class="co">##      cp[i] &lt;- cp0 ##B01* exp(cp.c - cp.H/R/T[i])/cp.ref</span></span>
<span><span class="co">##      Kc.T[i] &lt;- Kc ##B01* exp(Kc.c - Kc.H/R/T[i])/Kc.ref</span></span>
<span><span class="co">##      Ko.T[i] &lt;- Ko ##B01* exp(Ko.c - Ko.H/R/T[i])/Ko.ref</span></span>
<span><span class="co">##      Jmax[i] &lt;- Jmax0 ##J04 * exp(-(T[i]-To)*(T[i]-To)/(Omega*Omega))</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##      alpha[i] &lt;- alpha0 #AFORMULA</span></span>
<span><span class="co">##      al[i]&lt;-(alpha[i]*q[i]/(sqrt(1+(alpha[i]*alpha[i]*q[i]*q[i])/(Jmax[i]*Jmax[i]))))*(pi[i]-cp[i])/(4*pi[i]+8*cp[i])    ## electron transport limited without covariates</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##      vmax.refT[i] &lt;- vmax0 #VFORMULA</span></span>
<span><span class="co">##      vmax[i] &lt;- vmax.refT[i] ##B01* exp(Vc.c - Vc.H/R/T[i])</span></span>
<span><span class="co">##      ae[i]&lt;- vmax[i]*(pi[i]-cp[i])/(pi[i]+Kc.T[i]*(1+po/Ko.T[i]))                                                    ## maximum rubisco limited without covariates</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## #TPU    ap[i]&lt;-3*tpu                      ## phosphate limited</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##      pmean[i]&lt;-min(al[i], ae[i]) - r[i]      ## predicted net photosynthesis</span></span>
<span><span class="co">##      an[i]~dnorm(pmean[i],tau)            ## likelihood</span></span>
<span><span class="co">##      pA[i] ~ dnorm(pmean[i],tau)          ## prediction</span></span>
<span><span class="co">##      }</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##      foo &lt;- rep[1] + nrep + T[1]                ## prevent warnings</span></span>
<span><span class="co">## }</span></span></code></pre>
<p>Note that the lines beginning with # are comments. Some of these
comments are followed by specific tags, such as RLEAF.V and RLEAF.A,
which are bits of code that will get turned on when we specify leaf
random effects (see below).</p>
<p>The ‘params’ mcmc.list contains the parameter estimate MCMC chains,
which we can do standard MCMC diagnositics on.</p>
<p>(Note: It is OK to ignore the
<code>par(mfrow = ..., mar = ...)</code> calls that appear here and
elsewhere. We use them in this vignette to cram all the subplots
together as compactly as possible, but for everyday use of the package
is is perfectly fine to leave these parameters at their default
values.)</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">params</span>, auto.layout <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>    <span class="co">## MCMC diagnostic plots</span></span></code></pre></div>
<p><img src="ResponseCurves_files/figure-html/unnamed-chunk-5-1.png" width="100%"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">params</span><span class="op">)</span> <span class="co">## parameter estimates  </span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Iterations = 1:5000</span></span>
<span><span class="co">## Thinning interval = 1 </span></span>
<span><span class="co">## Number of chains = 3 </span></span>
<span><span class="co">## Sample size per chain = 5000 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 1. Empirical mean and standard deviation for each variable,</span></span>
<span><span class="co">##    plus standard error of the mean:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             Mean        SD  Naive SE Time-series SE</span></span>
<span><span class="co">## Jmax0  1.404e+02 2.889e+01 2.359e-01      8.891e-01</span></span>
<span><span class="co">## alpha0 2.761e-01 8.046e-02 6.570e-04      1.210e-03</span></span>
<span><span class="co">## cp0    4.636e+01 1.252e+01 1.022e-01      3.898e-01</span></span>
<span><span class="co">## r0     2.562e+00 1.571e+00 1.283e-02      3.910e-02</span></span>
<span><span class="co">## tau    7.084e-03 8.971e-04 7.325e-06      9.734e-06</span></span>
<span><span class="co">## vmax0  9.411e+01 7.253e+01 5.922e-01      2.058e+00</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 2. Quantiles for each variable:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             2.5%       25%       50%       75%     97.5%</span></span>
<span><span class="co">## Jmax0  1.017e+02 1.237e+02 1.361e+02 1.503e+02 2.164e+02</span></span>
<span><span class="co">## alpha0 1.346e-01 2.173e-01 2.716e-01 3.294e-01 4.452e-01</span></span>
<span><span class="co">## cp0    1.384e+01 4.014e+01 4.708e+01 5.394e+01 6.910e+01</span></span>
<span><span class="co">## r0     5.191e-01 1.387e+00 2.236e+00 3.385e+00 6.427e+00</span></span>
<span><span class="co">## tau    5.407e-03 6.466e-03 7.053e-03 7.668e-03 8.917e-03</span></span>
<span><span class="co">## vmax0  2.786e+01 4.811e+01 7.405e+01 1.162e+02 2.811e+02</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.plot.html" class="external-link">gelman.plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">params</span>, auto.layout <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="ResponseCurves_files/figure-html/unnamed-chunk-6-1.png" width="100%"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html" class="external-link">gelman.diag</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">params</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Potential scale reduction factors:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##        Point est. Upper C.I.</span></span>
<span><span class="co">## Jmax0        1.01       1.01</span></span>
<span><span class="co">## alpha0       1.00       1.00</span></span>
<span><span class="co">## cp0          1.01       1.03</span></span>
<span><span class="co">## r0           1.00       1.01</span></span>
<span><span class="co">## tau          1.00       1.00</span></span>
<span><span class="co">## vmax0        1.02       1.03</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Multivariate psrf</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 1.01</span></span></code></pre>
<p>The ‘predict’ object can be used to perform standard predictive
diagnostics and to construct CI around curves.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## predicted vs observed plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mstats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">predict</span><span class="op">)</span></span>
<span><span class="va">pmean</span> <span class="op">&lt;-</span> <span class="va">mstats</span><span class="op">$</span><span class="va">statistics</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"pmean"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">mstats</span><span class="op">$</span><span class="va">statistics</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pmean</span>, <span class="va">dat</span><span class="op">$</span><span class="va">Photo</span>, pch <span class="op">=</span> <span class="st">"+"</span>, xlab <span class="op">=</span> <span class="st">"Predicted A"</span>, ylab <span class="op">=</span> <span class="st">"Observed A"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col <span class="op">=</span> <span class="fl">2</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="ResponseCurves_files/figure-html/unnamed-chunk-7-1.png" width="50%"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_photo.html">plot_photo</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "No AQ data available"</span></span>
<span><span class="co">## [1] "No ACi data available"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "No AQ data available"</span></span>
<span><span class="co">## [1] "No ACi data available"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "No AQ data available"</span></span>
<span><span class="co">## [1] "No ACi data available"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "No AQ data available"</span></span>
<span><span class="co">## [1] "No ACi data available"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "No AQ data available"</span></span>
<span><span class="co">## [1] "No ACi data available"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "No AQ data available"</span></span>
<span><span class="co">## [1] "No ACi data available"</span></span></code></pre>
<p><img src="ResponseCurves_files/figure-html/unnamed-chunk-8-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="refit-with-leaf-level-random-effects">Refit with leaf-level random effects<a class="anchor" aria-label="anchor" href="#refit-with-leaf-level-random-effects"></a>
</h2>
<p>Next, let’s look at how to specify leaf-level random effects in the
model. To do so we’re going to add an extra arguement to the function,
which is a list of model specifications.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">A.model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a.fixed <span class="op">=</span> <span class="cn">NULL</span>, a.random <span class="op">=</span> <span class="st">"leaf"</span>, </span>
<span>                V.fixed <span class="op">=</span> <span class="cn">NULL</span>, V.random <span class="op">=</span> <span class="st">"leaf"</span>, </span>
<span>                n.iter <span class="op">=</span> <span class="fl">5000</span>, match <span class="op">=</span> <span class="st">"fname"</span><span class="op">)</span></span></code></pre></div>
<p>In this list a refers to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
and V refers to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>V</mi><mtext mathvariant="normal">cmax</mtext></msub><annotation encoding="application/x-tex">V_\textrm{cmax}</annotation></semantics></math>.
Fixed refers to the specification of the fixed effects, which we’re
leaving unspecified at the moment (NULL). Random refers to the
specification of random effects, which we’re setting to ‘leaf’ in order
allow
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi></mrow><annotation encoding="application/x-tex">alpha</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>V</mi><mtext mathvariant="normal">cmax</mtext></msub><annotation encoding="application/x-tex">V_\textrm{cmax}</annotation></semantics></math>
to vary on a leaf-by-leaf basis. Note: at the moment ‘leaf’ is the only
valid random effect, though in the future we hope to allow the
specification of arbitrary random effects in a covariate file (see next
section for how to specify covariates). Next, <em>n.iter</em> refers to
the number of MCMC iterations run by the model. Here we’re setting that
to 5000, which is the default. You can increase this if you find the
model isn’t converging. For example, if you wanted to increase the
iterations with the previous default model, you would set all the fixed
and random effects to NULL but increase n.iter. Finally, match is the
variable used both to group records into individual leaves and to match
individual leaves to covariate data. If you look at our photosynthesis
dataframe, <em>dat</em>, you’ll see that it has a column <em>fname</em>
that corresponds to the filename the data was read from (here we’re
assuming each file contains the data for one leaf, but it’s not hard to
add columns to your data if you want to group things in other ways)</p>
<p>Once the model is specified, the fitting and diagnostics are the same
as before.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"fitI.RData"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"fitI.RData"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span><span class="op">{</span></span>
<span>  <span class="va">fitI</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitA.html">fitA</a></span><span class="op">(</span><span class="va">dat</span>,model <span class="op">=</span> <span class="va">A.model</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">fitI</span>, file<span class="op">=</span><span class="st">"fitI.RData"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## Compiling model graph</span></span>
<span><span class="co">##    Resolving undeclared variables</span></span>
<span><span class="co">##    Allocating nodes</span></span>
<span><span class="co">## Graph information:</span></span>
<span><span class="co">##    Observed stochastic nodes: 133</span></span>
<span><span class="co">##    Unobserved stochastic nodes: 165</span></span>
<span><span class="co">##    Total graph size: 2556</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Initializing model</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fitI</span><span class="op">$</span><span class="va">params</span>, auto.layout <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>    <span class="co">## MCMC diagnostic plotssummary</span></span></code></pre></div>
<p><img src="ResponseCurves_files/figure-html/unnamed-chunk-10-1.png" width="100%"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.plot.html" class="external-link">gelman.plot</a></span><span class="op">(</span><span class="va">fitI</span><span class="op">$</span><span class="va">params</span>, auto.layout <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="ResponseCurves_files/figure-html/unnamed-chunk-11-1.png" width="100%"></p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html" class="external-link">gelman.diag</a></span><span class="op">(</span><span class="va">fitI</span><span class="op">$</span><span class="va">params</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Potential scale reduction factors:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##           Point est. Upper C.I.</span></span>
<span><span class="co">## Jmax0           1.11       1.27</span></span>
<span><span class="co">## alpha0          1.18       1.57</span></span>
<span><span class="co">## cp0             1.01       1.03</span></span>
<span><span class="co">## r0              1.01       1.03</span></span>
<span><span class="co">## tau             1.00       1.01</span></span>
<span><span class="co">## tau.Aleaf       1.00       1.01</span></span>
<span><span class="co">## tau.Vleaf       1.01       1.04</span></span>
<span><span class="co">## vmax0           1.10       1.11</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Multivariate psrf</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 1.13</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## predicted vs observed plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mstats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fitI</span><span class="op">$</span><span class="va">predict</span><span class="op">)</span></span>
<span><span class="va">pmean</span> <span class="op">&lt;-</span> <span class="va">mstats</span><span class="op">$</span><span class="va">statistics</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"pmean"</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">mstats</span><span class="op">$</span><span class="va">statistics</span><span class="op">)</span><span class="op">)</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pmean</span>, <span class="va">dat</span><span class="op">$</span><span class="va">Photo</span>, pch <span class="op">=</span> <span class="st">"+"</span>, xlab <span class="op">=</span> <span class="st">"Predicted A"</span>, ylab <span class="op">=</span> <span class="st">"Observed A"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,col<span class="op">=</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="ResponseCurves_files/figure-html/unnamed-chunk-12-1.png" width="50%"></p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_photo.html">plot_photo</a></span><span class="op">(</span><span class="va">dat</span>,<span class="va">fitI</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "No AQ data available"</span></span>
<span><span class="co">## [1] "No ACi data available"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "No AQ data available"</span></span>
<span><span class="co">## [1] "No ACi data available"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "No AQ data available"</span></span>
<span><span class="co">## [1] "No ACi data available"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "No AQ data available"</span></span>
<span><span class="co">## [1] "No ACi data available"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "No AQ data available"</span></span>
<span><span class="co">## [1] "No ACi data available"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "No AQ data available"</span></span>
<span><span class="co">## [1] "No ACi data available"</span></span></code></pre>
<p><img src="ResponseCurves_files/figure-html/unnamed-chunk-13-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="fitting-the-model-with-covariates">Fitting the model with covariates<a class="anchor" aria-label="anchor" href="#fitting-the-model-with-covariates"></a>
</h2>
<p>Next, let’s look at how to fit a model that includes covariates. To
begin with let’s load up some covariate data. In this specific case the
covariate data, leaf % Nitrogen, is simulated because no covariates were
actually measured for these leaves.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cov.data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"cov.csv"</span>, package <span class="op">=</span> <span class="st">"PEcAn.photosynthesis"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">cov.data</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">fname</th>
<th align="right">N</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">flux-course-1aci</td>
<td align="right">0.0175286</td>
</tr>
<tr class="even">
<td align="left">flux-course-1aq</td>
<td align="right">0.0238066</td>
</tr>
<tr class="odd">
<td align="left">flux-course-2aci</td>
<td align="right">0.0202750</td>
</tr>
<tr class="even">
<td align="left">flux-course-2aq</td>
<td align="right">0.0258545</td>
</tr>
<tr class="odd">
<td align="left">flux-course-3aci</td>
<td align="right">0.0234969</td>
</tr>
<tr class="even">
<td align="left">flux-course-3aq</td>
<td align="right">0.0240135</td>
</tr>
<tr class="odd">
<td align="left">flux-course-4aci</td>
<td align="right">0.0236842</td>
</tr>
<tr class="even">
<td align="left">flux-course-4aq</td>
<td align="right">0.0238648</td>
</tr>
<tr class="odd">
<td align="left">flux-course-5aci</td>
<td align="right">0.0124040</td>
</tr>
<tr class="even">
<td align="left">flux-course-5aq</td>
<td align="right">0.0239068</td>
</tr>
<tr class="odd">
<td align="left">flux-course-6aci</td>
<td align="right">0.0147226</td>
</tr>
<tr class="even">
<td align="left">flux-course-6aq</td>
<td align="right">0.0239943</td>
</tr>
</tbody>
</table>
<p>To define this model we’ll again define a list of model
specifications. Specifically we are going to set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>c</mi><mi>m</mi><mi>a</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">Vcmax</annotation></semantics></math>
to be linear functions of leaf N. To do this we’ll set V.fixed “N” and
we’ll set V.random to NULL to turn off the leaf random effect. For this
example we’ll leave
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
as random.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">C.model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>a.fixed <span class="op">=</span> <span class="cn">NULL</span>, a.random <span class="op">=</span> <span class="st">"leaf"</span>, </span>
<span>                V.fixed<span class="op">=</span> <span class="st">"N"</span>, V.random <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                n.iter <span class="op">=</span> <span class="fl">5000</span>, match <span class="op">=</span> <span class="st">"fname"</span><span class="op">)</span></span></code></pre></div>
<p>If we had additional covariates, for example SLA and chl (leaf
chlorophyll), we might write that model as “N + SLA + chl” if we just
wanted the direct effects and “N + SLA + chl + N<em>SLA + N</em>chl +
SLA*chl” if we also wanted the pairwise interactions. That said, in this
case we don’t have a large enough sample size to justify so many
covariates.</p>
<p>Also note that the rows in the photosynthesis data are matched to
rows in the covariate data using the column specified in the arguement
‘match’. The default for this, fname, is the filename for the
photosynthetic data. Typically one file corresponds to one leaf so each
set of traits match to each file. If you have your data organized
differently you’ll want to specify a different column match.</p>
<p>To call the <em>fitA</em> function we now have to pass not just the
photosynthetic data and the model, but also the covariate data.
Otherwise the fit and diagnostics are identical to before.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"fitC.RData"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="st">"fitC.RData"</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span><span class="op">{</span></span>
<span>  <span class="va">fitC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitA.html">fitA</a></span><span class="op">(</span><span class="va">dat</span>,<span class="va">cov.data</span>,model <span class="op">=</span> <span class="va">C.model</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">fitC</span>,file<span class="op">=</span><span class="st">"fitC.RData"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## Compiling model graph</span></span>
<span><span class="co">##    Resolving undeclared variables</span></span>
<span><span class="co">##    Allocating nodes</span></span>
<span><span class="co">## Graph information:</span></span>
<span><span class="co">##    Observed stochastic nodes: 133</span></span>
<span><span class="co">##    Unobserved stochastic nodes: 153</span></span>
<span><span class="co">##    Total graph size: 2569</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Initializing model</span></span></code></pre>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fitC</span><span class="op">$</span><span class="va">params</span>,auto.layout <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>    <span class="co">## MCMC diagnostic plots</span></span></code></pre></div>
<p><img src="ResponseCurves_files/figure-html/unnamed-chunk-17-1.png" width="100%"></p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fitC</span><span class="op">$</span><span class="va">params</span><span class="op">)</span> <span class="co">## parameter estimates  </span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Iterations = 1:5000</span></span>
<span><span class="co">## Thinning interval = 1 </span></span>
<span><span class="co">## Number of chains = 3 </span></span>
<span><span class="co">## Sample size per chain = 5000 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 1. Empirical mean and standard deviation for each variable,</span></span>
<span><span class="co">##    plus standard error of the mean:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                Mean       SD  Naive SE Time-series SE</span></span>
<span><span class="co">## Jmax0     335.00427 13.80159 1.127e-01      0.3661920</span></span>
<span><span class="co">## alpha0      0.17777  0.05708 4.661e-04      0.0155226</span></span>
<span><span class="co">## betaVN      0.66852 31.79278 2.596e-01      0.3350795</span></span>
<span><span class="co">## cp0        57.47418  2.06804 1.689e-02      0.0378175</span></span>
<span><span class="co">## r0          0.51220  0.24300 1.984e-03      0.0038977</span></span>
<span><span class="co">## tau         0.08087  0.01080 8.815e-05      0.0001135</span></span>
<span><span class="co">## tau.Aleaf  18.13453  9.27474 7.573e-02      0.2242958</span></span>
<span><span class="co">## vmax0      81.20954  5.62326 4.591e-02      0.1136773</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 2. Quantiles for each variable:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                2.5%       25%       50%       75%    97.5%</span></span>
<span><span class="co">## Jmax0     311.39678 325.71568 333.80670 342.98822 365.7708</span></span>
<span><span class="co">## alpha0      0.08127   0.13531   0.17375   0.22070   0.2920</span></span>
<span><span class="co">## betaVN    -62.15213 -20.85756   0.87897  22.11651  63.3827</span></span>
<span><span class="co">## cp0        53.34018  56.08678  57.48813  58.88719  61.4654</span></span>
<span><span class="co">## r0          0.16003   0.33234   0.47159   0.64788   1.0870</span></span>
<span><span class="co">## tau         0.06123   0.07328   0.08057   0.08775   0.1035</span></span>
<span><span class="co">## tau.Aleaf   5.11262  11.39503  16.45998  23.13388  40.6853</span></span>
<span><span class="co">## vmax0      74.41798  77.64859  79.90693  83.23238  95.7712</span></span></code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.plot.html" class="external-link">gelman.plot</a></span><span class="op">(</span><span class="va">fitC</span><span class="op">$</span><span class="va">params</span>, auto.layout <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="ResponseCurves_files/figure-html/unnamed-chunk-18-1.png" width="100%"></p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.diag.html" class="external-link">gelman.diag</a></span><span class="op">(</span><span class="va">fitC</span><span class="op">$</span><span class="va">params</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Potential scale reduction factors:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##           Point est. Upper C.I.</span></span>
<span><span class="co">## Jmax0           1.04       1.11</span></span>
<span><span class="co">## alpha0          1.65       3.31</span></span>
<span><span class="co">## betaVN          1.00       1.00</span></span>
<span><span class="co">## cp0             1.00       1.02</span></span>
<span><span class="co">## r0              1.00       1.00</span></span>
<span><span class="co">## tau             1.00       1.01</span></span>
<span><span class="co">## tau.Aleaf       1.06       1.17</span></span>
<span><span class="co">## vmax0           1.02       1.03</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Multivariate psrf</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 1.42</span></span></code></pre>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## predicted vs observed plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,  mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mstats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fitC</span><span class="op">$</span><span class="va">predict</span><span class="op">)</span></span>
<span><span class="va">pmean</span> <span class="op">&lt;-</span> <span class="va">mstats</span><span class="op">$</span><span class="va">statistics</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"pmean"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">mstats</span><span class="op">$</span><span class="va">statistics</span><span class="op">)</span><span class="op">)</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pmean</span>, <span class="va">dat</span><span class="op">$</span><span class="va">Photo</span>, pch <span class="op">=</span> <span class="st">"+"</span>, xlab <span class="op">=</span> <span class="st">"Predicted A"</span>, ylab <span class="op">=</span> <span class="st">"Observed A"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,col<span class="op">=</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="ResponseCurves_files/figure-html/unnamed-chunk-19-1.png" width="50%"></p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_photo.html">plot_photo</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">fitC</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "No AQ data available"</span></span>
<span><span class="co">## [1] "No ACi data available"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "No AQ data available"</span></span>
<span><span class="co">## [1] "No ACi data available"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "No AQ data available"</span></span>
<span><span class="co">## [1] "No ACi data available"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "No AQ data available"</span></span>
<span><span class="co">## [1] "No ACi data available"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "No AQ data available"</span></span>
<span><span class="co">## [1] "No ACi data available"</span></span></code></pre>
<pre><code><span><span class="co">## [1] "No AQ data available"</span></span>
<span><span class="co">## [1] "No ACi data available"</span></span></code></pre>
<p><img src="ResponseCurves_files/figure-html/unnamed-chunk-20-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="citations">Citations<a class="anchor" aria-label="anchor" href="#citations"></a>
</h2>
<p>Dietze, M.C. (2014). Gaps in knowledge and data driving uncertainty
in models of photosynthesis. Photosynth. Res., 19, 3–14.</p>
<p>Farquhar, G., Caemmerer, S. &amp; Berry, J.A. (1980). A biochemical
model of photosynthetic CO2 assimilation in leaves of C3 species.
Planta, 149, 78–90.</p>
<p>Feng, X. &amp; Dietze, M.C. (2013). Scale dependence in the effects
of leaf ecophysiological traits on photosynthesis: Bayesian
parameterization of photosynthesis models. New Phytol., 200,
1132–1144.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mike Dietze, Xiaohui Feng, Shawn Serbin, Shashank Singh.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
